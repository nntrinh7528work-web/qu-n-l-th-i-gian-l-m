# Auto-generated installer for Work Hours Tracker
import os

# Content mapping
files_content = {'app.py': '\ufeff# -*- coding: utf-8 -*-\n"""\n·ª®ng D·ª•ng Qu·∫£n L√Ω Gi·ªù L√†m\n========================\n·ª®ng d·ª•ng Streamlit ƒë·ªÉ qu·∫£n l√Ω gi·ªù l√†m vi·ªác, t√≠nh to√°n gi·ªù l√†m th√™m,\nv√† t√πy ch·ªânh l·ªãch l√†m vi·ªác.\n\nT√°c gi·∫£: AI Assistant\nNg√¥n ng·ªØ: Ti·∫øng Vi·ªát\n"""\n\n# Thi·∫øt l·∫≠p UTF-8 encoding cho Windows\nimport sys\nimport os\nos.environ[\'PYTHONIOENCODING\'] = \'utf-8\'\ntry:\n    if sys.stdout.encoding != \'utf-8\':\n        sys.stdout.reconfigure(encoding=\'utf-8\')\n    if sys.stderr.encoding != \'utf-8\':\n        sys.stderr.reconfigure(encoding=\'utf-8\')\nexcept Exception:\n    pass\n\nimport streamlit as st\nimport pandas as pd\nimport plotly.express as px\nimport plotly.graph_objects as go\nfrom datetime import datetime, date, time, timedelta\nimport calendar\nfrom io import BytesIO\n\n# Import c√°c module n·ªôi b·ªô\nimport db_wrapper as db  # T·ª± ƒë·ªông ch·ªçn Supabase ho·∫∑c SQLite\nimport calculations as calc\nimport user_auth as auth\n\n# ==================== C·∫§U H√åNH TRANG ====================\n\nst.set_page_config(\n    page_title="Work Tracker Pro",\n    page_icon="üöÄ",\n    layout="wide",\n    initial_sidebar_state="collapsed"\n)\n\n# ==================== CSS T√ôY CH·ªàNH (GEN Z STYLE) ====================\n\nst.markdown("""\n<style>\n    @import url(\'https://fonts.googleapis.com/css2?family=Outfit:wght@400;600;800&display=swap\');\n\n    html, body, [class*="css"] {\n        font-family: \'Outfit\', sans-serif;\n    }\n\n    /* Gradient Background Text */\n    .main-header {\n        font-size: 3rem;\n        font-weight: 800;\n        background: linear-gradient(to right, #FF0080, #FF8C00, #40E0D0);\n        -webkit-background-clip: text;\n        -webkit-text-fill-color: transparent;\n        text-align: center;\n        margin-bottom: 0.5rem;\n        text-transform: uppercase;\n        letter-spacing: 2px;\n    }\n\n    /* Modern Cards */\n    .stat-card {\n        background: rgba(255, 255, 255, 0.05);\n        backdrop-filter: blur(10px);\n        border: 1px solid rgba(255, 255, 255, 0.1);\n        padding: 1.5rem;\n        border-radius: 24px;\n        color: white;\n        text-align: center;\n        transition: transform 0.3s ease, box-shadow 0.3s ease;\n        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);\n    }\n    \n    .stat-card:hover {\n        transform: translateY(-5px);\n        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);\n        border-color: rgba(255, 255, 255, 0.3);\n    }\n\n    .stat-card h3 {\n        margin: 0;\n        font-size: 2.2rem;\n        font-weight: 800;\n        background: linear-gradient(45deg, #fff, #ccc);\n        -webkit-background-clip: text;\n        -webkit-text-fill-color: transparent;\n    }\n    \n    .stat-card p {\n        margin-top: 5px;\n        font-size: 1rem;\n        font-weight: 600;\n        opacity: 0.8;\n        text-transform: uppercase;\n        letter-spacing: 1px;\n    }\n\n    /* Result Box Styled */\n    .result-box {\n        background: #1E1E2E; /* Dark Indigo */\n        border: 2px solid #3B82F6;\n        border-radius: 20px;\n        padding: 1.5rem;\n        margin: 1rem 0;\n        box-shadow: 0 0 15px rgba(59, 130, 246, 0.3);\n    }\n    \n    .result-box h4 {\n        color: #60A5FA;\n        font-size: 1.2rem;\n        text-transform: uppercase;\n    }\n\n    /* Buttons */\n    .stButton button {\n        border-radius: 12px;\n        font-weight: 700;\n        text-transform: uppercase;\n        letter-spacing: 1px;\n        transition: all 0.3s ease;\n    }\n    \n    .stButton button:hover {\n        transform: scale(1.02);\n        box-shadow: 0 5px 15px rgba(0,0,0,0.2);\n    }\n\n    /* Calendar Cells */\n    .cal-cell {\n        border-radius: 16px;\n        padding: 12px;\n        text-align: center;\n        margin: 4px;\n        transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);\n        cursor: pointer;\n    }\n    \n    .cal-cell:hover {\n        transform: scale(1.1) rotate(2deg);\n        z-index: 10;\n    }\n    \n    .cal-cell.worked {\n        background: linear-gradient(135deg, #10B981 0%, #059669 100%);\n        box-shadow: 0 4px 12px rgba(16, 185, 129, 0.4);\n        border: none;\n        color: white;\n    }\n    \n    .cal-cell.holiday {\n        background: linear-gradient(135deg, #EF4444 0%, #DC2626 100%);\n        box-shadow: 0 4px 12px rgba(239, 68, 68, 0.4);\n        border: none;\n        color: white;\n    }\n    \n    .cal-day-num {\n        font-weight: 800;\n        font-size: 1.2rem;\n    }\n    \n    /* Tabs */\n    .stTabs [data-baseweb="tab-list"] {\n        gap: 1rem;\n        background: rgba(255,255,255,0.05);\n        padding: 10px;\n        border-radius: 20px;\n    }\n    \n    .stTabs [data-baseweb="tab"] {\n        height: 50px;\n        border-radius: 15px;\n        font-weight: 700;\n        font-size: 1rem;\n        border: none !important;\n    }\n    \n    .stTabs [aria-selected="true"] {\n        background: linear-gradient(90deg, #8B5CF6, #EC4899);\n        color: white !important;\n        box-shadow: 0 4px 15px rgba(236, 72, 153, 0.4);\n    }\n</style>\n""", unsafe_allow_html=True)\n\n# ==================== KI·ªÇM TRA ƒêƒÇNG NH·∫¨P ====================\n\n# Th·ª≠ Auto-login t·ª´ cookie\nauth.check_auto_login()\n\n# Hi·ªÉn th·ªã trang ƒëƒÉng nh·∫≠p n·∫øu ch∆∞a ƒëƒÉng nh·∫≠p\nif not auth.is_logged_in():\n    auth.show_login_page()\n    st.stop()\n\n# ƒê√£ ƒëƒÉng nh·∫≠p - kh·ªüi t·∫°o database cho user\ndb.init_database()\n\n# Hi·ªÉn th·ªã th√¥ng tin user ·ªü sidebar\nauth.show_user_info_sidebar()\n\n# ==================== HEADER ====================\n\nst.markdown(\'<h1 class="main-header">‚ú® Qu·∫£n L√Ω Gi·ªù L√†m üöÄ</h1>\', unsafe_allow_html=True)\n\n# ==================== DASHBOARD T·ªîNG QUAN ====================\n\n# L·∫•y d·ªØ li·ªáu th√°ng hi·ªán t·∫°i\ncurrent_month = date.today().month\ncurrent_year = date.today().year\nmonth_start = date(current_year, current_month, 1)\n\n# L·∫•y t·∫•t c·∫£ ca l√†m vi·ªác trong th√°ng\nall_shifts_month = db.get_shifts_by_range(month_start, date.today())\nall_jobs = db.get_all_jobs()\njob_map_dashboard = {j[\'id\']: j for j in all_jobs}\n\n# T√≠nh t·ªïng\ntotal_hours_month = 0\ntotal_salary_month = 0\nwork_days_set = set()\n\nfor shift in all_shifts_month:\n    hours = shift.get(\'total_hours\', 0)\n    job_id = shift.get(\'job_id\', 0)\n    hourly_rate = job_map_dashboard.get(job_id, {}).get(\'hourly_rate\', 0)\n    \n    total_hours_month += hours\n    total_salary_month += hours * hourly_rate\n    work_days_set.add(shift.get(\'work_date\'))\n\ntotal_days_month = len(work_days_set)\n\n# Hi·ªÉn th·ªã Dashboard\ncol_d1, col_d2, col_d3, col_d4 = st.columns(4)\n\nwith col_d1:\n    st.markdown(f"""\n    <div class="stat-card" style="background: linear-gradient(135deg, #FF0080 0%, #7928CA 100%);">\n        <h3>üìÖ {total_days_month}</h3>\n        <p>Ng√†y l√†m</p>\n    </div>\n    """, unsafe_allow_html=True)\n\nwith col_d2:\n    st.markdown(f"""\n    <div class="stat-card" style="background: linear-gradient(135deg, #4AF699 0%, #12B886 100%);">\n        <h3>‚è±Ô∏è {total_hours_month:.1f}h</h3>\n        <p>T·ªïng gi·ªù</p>\n    </div>\n    """, unsafe_allow_html=True)\n\nwith col_d3:\n    st.markdown(f"""\n    <div class="stat-card" style="background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);">\n        <h3>üí∏ {total_salary_month:,.0f}</h3>\n        <p>L∆∞∆°ng (Yen)</p>\n    </div>\n    """, unsafe_allow_html=True)\n\nwith col_d4:\n    avg_per_day = total_salary_month / total_days_month if total_days_month > 0 else 0\n    st.markdown(f"""\n    <div class="stat-card" style="background: linear-gradient(135deg, #00C6FB 0%, #005BEA 100%);">\n        <h3>üî• {avg_per_day:,.0f}</h3>\n        <p>TB/ng√†y</p>\n    </div>\n    """, unsafe_allow_html=True)\n\nst.markdown("<br>", unsafe_allow_html=True)\n\n# ==================== TABS ====================\n\ntab1, tab2, tab3, tab4 = st.tabs([\n    "üéÆ Nh·∫≠p Gi·ªù", \n    "üìÖ L·ªãch L√†m", \n    "üìà B√°o C√°o", \n    "‚öôÔ∏è C√†i ƒê·∫∑t"\n])\n\n# ==================== TAB 1: NH·∫¨P GI·ªú L√ÄM ====================\n\nwith tab1:\n    st.header("üéÆ Nh·∫≠p Gi·ªù L√†m Vi·ªác")\n    \n    # ==================== QUICK ENTRY MODE ====================\n    st.markdown("### ‚ö° Quick Entry - Log Nhanh")\n    \n    # L·∫•y danh s√°ch c√¥ng vi·ªác cho quick entry\n    quick_jobs = db.get_all_jobs()\n    quick_job_map = {j[\'id\']: j for j in quick_jobs}\n    \n    if quick_jobs:\n        quick_col1, quick_col2, quick_col3, quick_col4 = st.columns(4)\n        \n        # L·∫•y job ƒë·∫ßu ti√™n l√†m m·∫∑c ƒë·ªãnh\n        default_job = quick_jobs[0] if quick_jobs else None\n        \n        with quick_col1:\n            if st.button("‚òÄÔ∏è Ca S√°ng 8h\\n(8:00-17:00)", use_container_width=True, key="quick_morning"):\n                if default_job:\n                    shift_id = db.add_work_shift(\n                        work_date=date.today(),\n                        shift_name="Ca S√°ng",\n                        start_time="08:00",\n                        end_time="17:00",\n                        break_hours=1.0,\n                        total_hours=8.0,\n                        notes="Quick Entry",\n                        job_id=default_job[\'id\']\n                    )\n                    if shift_id > 0:\n                        st.success("‚úÖ ƒê√£ log ca s√°ng 8h!")\n                        st.rerun()\n        \n        with quick_col2:\n            if st.button("üåô Ca T·ªëi 8h\\n(17:00-02:00)", use_container_width=True, key="quick_evening"):\n                if default_job:\n                    shift_id = db.add_work_shift(\n                        work_date=date.today(),\n                        shift_name="Ca T·ªëi",\n                        start_time="17:00",\n                        end_time="02:00",\n                        break_hours=1.0,\n                        total_hours=8.0,\n                        notes="Quick Entry",\n                        job_id=default_job[\'id\']\n                    )\n                    if shift_id > 0:\n                        st.success("‚úÖ ƒê√£ log ca t·ªëi 8h!")\n                        st.rerun()\n        \n        with quick_col3:\n            if st.button("‚è∞ Part-time 4h\\n(17:00-21:00)", use_container_width=True, key="quick_parttime"):\n                if default_job:\n                    shift_id = db.add_work_shift(\n                        work_date=date.today(),\n                        shift_name="Part-time",\n                        start_time="17:00",\n                        end_time="21:00",\n                        break_hours=0.0,\n                        total_hours=4.0,\n                        notes="Quick Entry",\n                        job_id=default_job[\'id\']\n                    )\n                    if shift_id > 0:\n                        st.success("‚úÖ ƒê√£ log part-time 4h!")\n                        st.rerun()\n        \n        with quick_col4:\n            if st.button("üî• Full Day 10h\\n(8:00-19:00)", use_container_width=True, key="quick_fullday"):\n                if default_job:\n                    shift_id = db.add_work_shift(\n                        work_date=date.today(),\n                        shift_name="Full Day",\n                        start_time="08:00",\n                        end_time="19:00",\n                        break_hours=1.0,\n                        total_hours=10.0,\n                        notes="Quick Entry",\n                        job_id=default_job[\'id\']\n                    )\n                    if shift_id > 0:\n                        st.success("‚úÖ ƒê√£ log full day 10h!")\n                        st.rerun()\n        \n        st.caption(f"üí° Quick Entry s·∫Ω log v√†o **{default_job[\'job_name\']}** cho **h√¥m nay**")\n    \n    st.markdown("---")\n    \n    # ==================== NH·∫¨P CHI TI·∫æT ====================\n    st.markdown("### üìù Nh·∫≠p Chi Ti·∫øt")\n    \n    # Ch·ªçn ng√†y\n    work_date = st.date_input(\n        "üìÖ Ch·ªçn ng√†y l√†m vi·ªác:",\n        value=date.today(),\n        format="DD/MM/YYYY",\n        key="main_work_date"\n    )\n    \n    # Ki·ªÉm tra ng√†y ngh·ªâ\n    is_hol, hol_desc = db.is_holiday(work_date)\n    if is_hol:\n        st.warning(f"‚ö†Ô∏è Ng√†y n√†y l√† ng√†y ngh·ªâ: **{hol_desc}**")\n    \n    # L·∫•y c√°c ca l√†m vi·ªác hi·ªán c√≥\n    existing_shifts = db.get_shifts_by_date(work_date)\n    standard_hours = db.get_standard_hours()\n    total_hours_day = 0  # Kh·ªüi t·∫°o bi·∫øn\n    \n    # Hi·ªÉn th·ªã c√°c ca ƒë√£ c√≥\n    if existing_shifts:\n        st.subheader(f"üìå C√°c Ca L√†m Vi·ªác Ng√†y {work_date.strftime(\'%d/%m/%Y\')}")\n        \n        # T√≠nh t·ªïng gi·ªù v√† l∆∞∆°ng\n        total_hours_day = sum(s[\'total_hours\'] for s in existing_shifts)\n        \n        # T√≠nh l∆∞∆°ng ∆∞·ªõc t√≠nh cho ng√†y n√†y\n        all_jobs = db.get_all_jobs()\n        job_map = {j[\'id\']: j for j in all_jobs}\n        total_salary_day = 0\n        \n        for shift in existing_shifts:\n            job_id = shift.get(\'job_id\', 1)\n            if job_id in job_map:\n                hourly_rate = job_map[job_id][\'hourly_rate\']\n                total_salary_day += shift[\'total_hours\'] * hourly_rate\n        \n        # Hi·ªÉn th·ªã metrics\n        col_m1, col_m2, col_m3 = st.columns(3)\n        with col_m1:\n            st.metric("üéØ S·ªë ca", f"{len(existing_shifts)} ca")\n        with col_m2:\n            st.metric("‚åõ T·ªïng gi·ªù", calc.format_hours(total_hours_day))\n        with col_m3:\n            st.metric("üíù L∆∞∆°ng ng√†y", f"{total_salary_day:,.0f} Yen")\n        \n        st.markdown("---")\n        \n        # Hi·ªÉn th·ªã t·ª´ng ca v·ªõi th√¥ng tin l∆∞∆°ng\n        for i, shift in enumerate(existing_shifts):\n            job_id = shift.get(\'job_id\', 1)\n            job_name = job_map.get(job_id, {}).get(\'job_name\', \'N/A\')\n            hourly_rate = job_map.get(job_id, {}).get(\'hourly_rate\', 0)\n            shift_salary = shift[\'total_hours\'] * hourly_rate\n            \n            with st.expander(f"üåü {shift[\'shift_name\']} - {job_name} ({shift[\'total_hours\']}h = {shift_salary:,.0f} Yen)", expanded=False):\n                col_info, col_action = st.columns([3, 1])\n                \n                with col_info:\n                    st.write(f"**N∆°i l√†m:** {job_name}")\n                    st.write(f"**Th·ªùi gian:** {shift[\'start_time\']} - {shift[\'end_time\']}")\n                    st.write(f"**Ngh·ªâ:** {shift[\'break_hours\']} gi·ªù")\n                    st.write(f"**T·ªïng gi·ªù:** {calc.format_hours(shift[\'total_hours\'])}")\n                    st.write(f"**L∆∞∆°ng:** {shift_salary:,.0f} Yen ({hourly_rate:,.0f} Yen/h)")\n                    if shift[\'notes\']:\n                        st.write(f"**Ghi ch√∫:** {shift[\'notes\']}")\n                \n                with col_action:\n                    if st.button("üóëÔ∏è X√≥a", key=f"del_shift_{shift[\'id\']}", use_container_width=True):\n                        if db.delete_work_shift(shift[\'id\']):\n                            st.success("ƒê√£ x√≥a ca!")\n                            st.rerun()\n                        else:\n                            st.error("L·ªói khi x√≥a!")\n        \n        st.markdown("---")\n    \n    # Form th√™m ca m·ªõi\n    st.subheader("‚ú® Th√™m Ca L√†m Vi·ªác M·ªõi")\n    \n    col1, col2 = st.columns([1, 1])\n    \n    with col1:\n        # L·∫•y danh s√°ch c√¥ng vi·ªác\n        all_jobs = db.get_all_jobs()\n        job_map = {j[\'id\']: j for j in all_jobs}\n        \n        # T·∫°o danh s√°ch hi·ªÉn th·ªã: B·ªánh vi·ªán v√† Kombini tr∆∞·ªõc, c√°c c√¥ng vi·ªác kh√°c sau\n        display_jobs = []\n        \n        # T√¨m B·ªánh vi·ªán v√† Kombini\n        for name in [\'B·ªánh vi·ªán\', \'Kombini\']:\n            for job in all_jobs:\n                if job[\'job_name\'] == name:\n                    display_jobs.append(job)\n                    break\n        \n        # Th√™m c√°c c√¥ng vi·ªác kh√°c (kh√¥ng ph·∫£i B·ªánh vi·ªán, Kombini, C√¥ng vi·ªác ch√≠nh)\n        for job in all_jobs:\n            if job[\'job_name\'] not in [\'B·ªánh vi·ªán\', \'Kombini\', \'C√¥ng vi·ªác ch√≠nh\', \'C√¥ng vi·ªác kh√°c\']:\n                display_jobs.append(job)\n        \n        # N·∫øu kh√¥ng c√≥ job n√†o, d√πng t·∫•t c·∫£\n        if not display_jobs:\n            display_jobs = all_jobs\n        \n        # Ch·ªçn n∆°i l√†m vi·ªác b·∫±ng Radio Button\n        if display_jobs:\n            selected_job_id = st.radio(\n                "üè† Ch·ªçn N∆°i L√†m Vi·ªác:",\n                options=[j[\'id\'] for j in display_jobs],\n                format_func=lambda x: f"{job_map[x][\'job_name\']} ({job_map[x][\'hourly_rate\']:,.0f}ƒë/h)",\n                horizontal=True,\n                key="job_radio"\n            )\n        else:\n            selected_job_id = None\n            st.warning("Ch∆∞a c√≥ c√¥ng vi·ªác n√†o. H√£y th√™m c√¥ng vi·ªác b√™n d∆∞·ªõi!")\n        \n        # N√∫t th√™m c√¥ng vi·ªác m·ªõi\n        with st.expander("üå∫ Th√™m c√¥ng vi·ªác m·ªõi"):\n            new_name = st.text_input("T√™n c√¥ng vi·ªác:", key="new_job_name", placeholder="VD: Restaurant, Shop...")\n            new_rate = st.number_input("L∆∞∆°ng gi·ªù (Yen):", min_value=0, value=1000, step=50, key="new_job_rate")\n            \n            if st.button("Th√™m C√¥ng Vi·ªác", key="btn_add_job", type="primary"):\n                if new_name and new_name.strip():\n                    result = db.add_job(new_name.strip(), new_rate, "")\n                    if result > 0:\n                        st.success(f"Da them: {new_name} - {new_rate} Yen/h")\n                        st.rerun()\n                    else:\n                        st.error("Loi khi them cong viec!")\n                else:\n                    st.warning("Vui long nhap ten cong viec!")\n        \n        # T√™n ca\n        shift_count = len(existing_shifts) + 1\n        default_shift_names = ["Ca s√°ng", "Ca chi·ªÅu", "Ca t·ªëi", "Ca ƒë√™m"]\n        default_name = default_shift_names[min(shift_count - 1, len(default_shift_names) - 1)] if shift_count <= 4 else f"Ca {shift_count}"\n        \n        shift_name = st.text_input(\n            "üìõ T√™n ca:",\n            value=default_name,\n            placeholder="V√≠ d·ª•: Ca s√°ng, Ca t·ªëi, C√¥ng vi·ªác 2..."\n        )\n        \n        # Gi·ªù b·∫Øt ƒë·∫ßu\n        col_start, col_end = st.columns(2)\n        \n        with col_start:\n            # ƒê·ªÅ xu·∫•t gi·ªù b·∫Øt ƒë·∫ßu d·ª±a tr√™n ca tr∆∞·ªõc\n            if existing_shifts:\n                last_end = existing_shifts[-1][\'end_time\']\n                h, m = map(int, last_end.split(\':\'))\n                default_start = time(h, m)\n            else:\n                default_start = time(8, 0)\n            \n            start_time = st.time_input(\n                "üåü Gi·ªù b·∫Øt ƒë·∫ßu:",\n                value=default_start,\n                step=timedelta(minutes=15),\n                key="new_shift_start"\n            )\n        \n        with col_end:\n            # ƒê·ªÅ xu·∫•t gi·ªù k·∫øt th√∫c\n            default_end = time(17, 0) if not existing_shifts else time(0, 0)\n            \n            end_time = st.time_input(\n                "üïî Gi·ªù k·∫øt th√∫c:",\n                value=default_end,\n                step=timedelta(minutes=15),\n                key="new_shift_end",\n                help="üí° H·ªó tr·ª£ ca qua ƒë√™m: v√≠ d·ª• 22:00 - 06:00"\n            )\n        \n        # Gi·ªù ngh·ªâ\n        break_hours = st.number_input(\n            "‚òï Gi·ªù ngh·ªâ (gi·ªù):",\n            min_value=0.0,\n            max_value=4.0,\n            value=0.0 if existing_shifts else db.get_default_break_hours(),\n            step=0.25,\n            help="ƒê·ªÉ 0 n·∫øu ca n√†y kh√¥ng c√≥ ngh·ªâ",\n            key="new_shift_break"\n        )\n        \n        # Ghi ch√∫\n        notes = st.text_input(\n            "‚úèÔ∏è Ghi ch√∫ (t√πy ch·ªçn):",\n            placeholder="V√≠ d·ª•: C√¥ng vi·ªác A, d·ª± √°n XYZ...",\n            key="new_shift_notes"\n        )\n    \n    with col2:\n        st.subheader("üëÄ Xem Tr∆∞·ªõc")\n        \n        # Chuy·ªÉn ƒë·ªïi time sang string\n        start_str = start_time.strftime("%H:%M")\n        end_str = end_time.strftime("%H:%M")\n        \n        # T√≠nh to√°n cho ca m·ªõi\n        result = calc.calculate_full(start_str, end_str, break_hours, standard_hours)\n        \n        if result["success"]:\n            # T√≠nh t·ªïng ng√†y n·∫øu th√™m ca n√†y\n            new_total_day = (total_hours_day if existing_shifts else 0) + result[\'total_hours\']\n            new_ot_day = max(0, new_total_day - standard_hours)\n            \n            # Hi·ªÉn th·ªã preview\n            is_overnight = end_time <= start_time\n            time_display = f"{start_str} - {end_str}" + (" üåõ" if is_overnight else "")\n            \n            # T√≠nh l∆∞∆°ng ∆∞·ªõc t√≠nh\n            job_rate = job_map.get(selected_job_id, {}).get(\'hourly_rate\', 0) if selected_job_id else 0\n            shift_salary = result[\'total_hours\'] * job_rate\n            \n            st.markdown(f"""\n            <div class="result-box">\n                <h4>üåü Ca: {shift_name}</h4>\n                <p><strong>üåü Th·ªùi gian:</strong> {time_display}</p>\n                <p><strong>‚åõ Gi·ªù l√†m ca n√†y:</strong> <span class="text-success" style="font-size: 1.3rem;">{calc.format_hours(result[\'total_hours\'])}</span></p>\n                <p><strong>üíù L∆∞∆°ng ∆∞·ªõc t√≠nh:</strong> <span class="text-warning" style="font-size: 1.3rem;">{shift_salary:,.0f} Yen</span></p>\n                <hr>\n                <p><strong>üìÖ T·ªïng gi·ªù ng√†y (sau khi th√™m):</strong> <span style="font-size: 1.2rem;">{calc.format_hours(new_total_day)}</span></p>\n            </div>\n            """, unsafe_allow_html=True)\n            \n            # N√∫t th√™m ca\n            if st.button("‚ú® Th√™m Ca L√†m Vi·ªác", type="primary", use_container_width=True):\n                shift_id = db.add_work_shift(\n                    work_date=work_date,\n                    shift_name=shift_name,\n                    start_time=start_str,\n                    end_time=end_str,\n                    break_hours=break_hours,\n                    total_hours=result[\'total_hours\'],\n                    notes=notes,\n                    job_id=selected_job_id\n                )\n                \n                if shift_id > 0:\n                    st.success(f"üéâ ƒê√£ th√™m {shift_name} th√†nh c√¥ng!")\n                    st.balloons()\n                    st.rerun()\n                else:\n                    st.error("üòø L·ªói khi th√™m ca. Vui l√≤ng th·ª≠ l·∫°i!")\n        else:\n            st.markdown(f"""\n            <div class="error-box">\n                <p>{result[\'error_message\']}</p>\n            </div>\n            """, unsafe_allow_html=True)\n    \n    # X√≥a t·∫•t c·∫£ ca c·ªßa ng√†y\n    if existing_shifts:\n        st.markdown("---")\n        \n        # Hi·ªÉn th·ªã t·ªïng k·∫øt ng√†y v√† n√∫t ho√†n th√†nh\n        st.subheader("üåà T·ªïng K·∫øt Ng√†y")\n        \n        col_summary1, col_summary2 = st.columns(2)\n        \n        with col_summary1:\n            st.markdown(f"""\n            <div class="result-box">\n                <h4>üìÖ Ng√†y {work_date.strftime(\'%d/%m/%Y\')}</h4>\n                <p><strong>üéØ S·ªë ca:</strong> {len(existing_shifts)} ca</p>\n                <p><strong>‚åõ T·ªïng gi·ªù l√†m:</strong> <span class="text-success">{calc.format_hours(total_hours_day)}</span></p>\n                <p><strong>üíù T·ªïng l∆∞∆°ng:</strong> <span class="text-warning">{total_salary_day:,.0f} Yen</span></p>\n            </div>\n            """, unsafe_allow_html=True)\n        \n        with col_summary2:\n            # Chi ti·∫øt c√°c ca v·ªõi l∆∞∆°ng\n            shifts_info = "<br>".join([\n                f"‚Ä¢ {s[\'shift_name\']}: {s[\'total_hours\']}h = {s[\'total_hours\'] * job_map.get(s.get(\'job_id\', 1), {}).get(\'hourly_rate\', 0):,.0f} Yen"\n                for s in existing_shifts\n            ])\n            st.markdown(f"""\n            <div class="result-box" style="font-size: 0.9rem;">\n                <h4>üìå Chi Ti·∫øt C√°c Ca</h4>\n                {shifts_info}\n            </div>\n            """, unsafe_allow_html=True)\n        \n        # N√∫t Ho√†n th√†nh v√† X√≥a\n        col_complete, col_delete = st.columns([2, 1])\n        \n        with col_complete:\n            if st.button("üéä Ho√†n Th√†nh Nh·∫≠p Li·ªáu", type="primary", use_container_width=True):\n                st.success(f"""\n                üéä **ƒê√£ ho√†n th√†nh nh·∫≠p li·ªáu cho ng√†y {work_date.strftime(\'%d/%m/%Y\')}!**\n                \n                - üìÖ S·ªë ca: **{len(existing_shifts)} ca**\n                - ‚åõ T·ªïng gi·ªù: **{calc.format_hours(total_hours_day)}**\n                - üíù T·ªïng l∆∞∆°ng: **{total_salary_day:,.0f} Yen**\n                \n                B·∫°n c√≥ th·ªÉ xem trong tab **üóìÔ∏è L·ªãch L√†m** ƒë·ªÉ ki·ªÉm tra.\n                """)\n                st.balloons()\n        \n        with col_delete:\n            if st.button("üóëÔ∏è X√≥a T·∫•t C·∫£", use_container_width=True):\n                if db.delete_work_log(work_date):\n                    st.success("üóëÔ∏è ƒê√£ x√≥a t·∫•t c·∫£ ca!")\n                    st.rerun()\n                else:\n                    st.error("üòø L·ªói khi x√≥a!")\n\n# ==================== TAB 2: L·ªäCH L√ÄM ====================\n\nwith tab2:\n    st.header("üóìÔ∏è L·ªãch L√†m Vi·ªác")\n    \n    # Ch·ªçn th√°ng/nƒÉm\n    col_month, col_year, col_view = st.columns([1, 1, 1])\n    \n    with col_month:\n        selected_month = st.selectbox(\n            "Th√°ng:",\n            options=list(range(1, 13)),\n            index=date.today().month - 1,\n            format_func=lambda x: f"Th√°ng {x}"\n        )\n    \n    with col_year:\n        current_year = date.today().year\n        selected_year = st.selectbox(\n            "NƒÉm:",\n            options=list(range(current_year - 5, current_year + 2)),\n            index=5  # Current year\n        )\n    \n    with col_view:\n        view_type = st.selectbox(\n            "Ki·ªÉu xem:",\n            options=["L·ªãch th√°ng", "Danh s√°ch"]\n        )\n    \n    # L·∫•y d·ªØ li·ªáu th√°ng\n    try:\n        work_logs = db.get_work_logs_by_month(selected_year, selected_month)\n    except Exception as e:\n        # N·∫øu l·ªói (c√≥ th·ªÉ do ch∆∞a init table m·ªõi), th·ª≠ init l·∫°i\n        # st.warning(f"ƒêang ƒë·ªìng b·ªô d·ªØ li·ªáu... ({e})")\n        db.init_database()\n        try:\n            work_logs = db.get_work_logs_by_month(selected_year, selected_month)\n        except Exception:\n            work_logs = []\n    holidays = db.get_holidays_by_year(selected_year)\n    holiday_dates = [h[\'holiday_date\'] for h in holidays]\n    \n    # T·∫°o dict ƒë·ªÉ tra c·ª©u nhanh\n    log_dict = {log[\'work_date\']: log for log in work_logs}\n    \n    if view_type == "L·ªãch th√°ng":\n        # T·∫°o calendar view\n        st.subheader(f"üìÖ L·ªãch Th√°ng {selected_month}/{selected_year}")\n        \n        # L·∫•y calendar c·ªßa th√°ng\n        cal = calendar.Calendar(firstweekday=0)  # Monday = 0\n        month_days = list(cal.itermonthdays2(selected_year, selected_month))\n        \n        # Header ng√†y trong tu·∫ßn\n        weekdays = ["Th·ª© 2", "Th·ª© 3", "Th·ª© 4", "Th·ª© 5", "Th·ª© 6", "Th·ª© 7", "CN"]\n        cols = st.columns(7)\n        for i, day_name in enumerate(weekdays):\n            with cols[i]:\n                st.markdown(f"**{day_name}**")\n        \n        # Hi·ªÉn th·ªã c√°c tu·∫ßn\n        week = []\n        for day, weekday in month_days:\n            week.append((day, weekday))\n            if len(week) == 7:\n                cols = st.columns(7)\n                for i, (d, wd) in enumerate(week):\n                    with cols[i]:\n                        if d == 0:\n                            st.write("")\n                        else:\n                            day_date = date(selected_year, selected_month, d)\n                            day_str = day_date.isoformat()\n                            \n                            # X√°c ƒë·ªãnh tr·∫°ng th√°i ng√†y\n                            if day_str in holiday_dates:\n                                st.markdown(f"""\n                                <div class="cal-cell holiday">\n                                    <div class="cal-day-num">{d}</div>\n                                    <div class="cal-day-info text-error">üå∏ Ngh·ªâ l·ªÖ</div>\n                                </div>\n                                """, unsafe_allow_html=True)\n                            elif day_str in log_dict:\n                                log = log_dict[day_str]\n                                shift_count = log.get(\'shift_count\', 1)\n                                shift_label = f"({shift_count} ca)" if shift_count > 1 else ""\n                                \n                                st.markdown(f"""\n                                <div class="cal-cell worked">\n                                    <div class="cal-day-num">{d}</div>\n                                    <div class="cal-day-info text-success">‚úø {log[\'total_hours\']}h</div>\n                                    <div class="cal-day-info" style="font-size:0.65rem;">{shift_label}</div>\n                                </div>\n                                """, unsafe_allow_html=True)\n                            elif wd >= 5:  # Weekend\n                                st.markdown(f"""\n                                <div class="cal-cell weekend">\n                                    <div class="cal-day-num text-muted">{d}</div>\n                                    <div class="cal-day-info text-muted">Cu·ªëi tu·∫ßn</div>\n                                </div>\n                                """, unsafe_allow_html=True)\n                            else:\n                                st.markdown(f"""\n                                <div class="cal-cell empty">\n                                    <div class="cal-day-num">{d}</div>\n                                    <div class="cal-day-info text-muted">-</div>\n                                </div>\n                                """, unsafe_allow_html=True)\n                week = []\n        \n        # Ch√∫ th√≠ch\n        st.markdown("---")\n        st.markdown("""\n        **Ch√∫ th√≠ch:**\n        - üü¢ Xanh l√°: Ng√†y c√≥ l√†m vi·ªác\n        - üî¥ ƒê·ªè: Ng√†y ngh·ªâ l·ªÖ\n        - ‚¨ú Tr·∫Øng: Ch∆∞a c√≥ d·ªØ li·ªáu\n        """)\n        \n        # T·ªïng k·∫øt th√°ng cho L·ªãch th√°ng\n        if work_logs:\n            st.markdown("---")\n            st.subheader("üåà T·ªïng K·∫øt Th√°ng")\n            \n            total_days = len(work_logs)\n            total_hours = sum(log[\'total_hours\'] for log in work_logs)\n            avg_hours = total_hours / total_days if total_days > 0 else 0\n            \n            # Hi·ªÉn th·ªã metrics (kh√¥ng c√≥ OT)\n            col1, col2, col3 = st.columns(3)\n            with col1:\n                st.metric(\n                    label="üìÖ Ng√†y L√†m Vi·ªác",\n                    value=f"{total_days} ng√†y"\n                )\n            with col2:\n                st.metric(\n                    label="‚è±Ô∏è T·ªïng Gi·ªù L√†m",\n                    value=calc.format_hours(total_hours)\n                )\n            with col3:\n                st.metric(\n                    label="üìä Trung B√¨nh/Ng√†y",\n                    value=calc.format_hours(avg_hours)\n                )\n        else:\n            st.info("‚ÑπÔ∏è Ch∆∞a c√≥ d·ªØ li·ªáu gi·ªù l√†m cho th√°ng n√†y.")\n    \n    else:  # Danh s√°ch\n        st.subheader(f"üìã Danh S√°ch Gi·ªù L√†m Th√°ng {selected_month}/{selected_year}")\n        \n        if work_logs:\n            # T·∫°o DataFrame\n            df = pd.DataFrame(work_logs)\n            \n            # Format l·∫°i c√°c c·ªôt\n            df[\'work_date\'] = pd.to_datetime(df[\'work_date\']).dt.strftime(\'%d/%m/%Y\')\n            df[\'total_hours\'] = df[\'total_hours\'].apply(lambda x: f"{x} gi·ªù")\n            \n            # ƒê·ªïi t√™n c·ªôt (b·ªè OT)\n            df_display = df[[\'work_date\', \'start_time\', \'end_time\', \'break_hours\', \'total_hours\', \'notes\']].copy()\n            df_display.columns = [\'Ng√†y\', \'Gi·ªù b·∫Øt ƒë·∫ßu\', \'Gi·ªù k·∫øt th√∫c\', \'Ngh·ªâ (h)\', \'T·ªïng gi·ªù\', \'Ghi ch√∫\']\n            \n            st.dataframe(df_display, use_container_width=True, hide_index=True)\n            \n            # T·ªïng k·∫øt th√°ng (kh√¥ng OT)\n            st.markdown("---")\n            total_days = len(work_logs)\n            total_hours = sum(log[\'total_hours\'] for log in work_logs)\n            \n            col1, col2 = st.columns(2)\n            with col1:\n                st.metric("üìÖ S·ªë ng√†y l√†m vi·ªác", f"{total_days} ng√†y")\n            with col2:\n                st.metric("‚åõ T·ªïng gi·ªù l√†m", calc.format_hours(total_hours))\n        else:\n            st.info("‚ÑπÔ∏è Ch∆∞a c√≥ d·ªØ li·ªáu gi·ªù l√†m cho th√°ng n√†y.")\n    \n    # ==================== CH·ªàNH S·ª¨A CA L√ÄM VI·ªÜC ====================\n    st.markdown("---")\n    st.subheader("‚úèÔ∏è Ch·ªânh S·ª≠a Ca L√†m Vi·ªác")\n    \n    # Ch·ªçn ng√†y ƒë·ªÉ ch·ªânh s·ª≠a\n    col_edit_date, col_edit_info = st.columns([1, 2])\n    \n    with col_edit_date:\n        # T·∫°o ng√†y m·∫∑c ƒë·ªãnh trong th√°ng ƒëang xem\n        default_edit_date = date(selected_year, selected_month, min(date.today().day, 28))\n        edit_date = st.date_input(\n            "üóìÔ∏è Ch·ªçn ng√†y ƒë·ªÉ xem/s·ª≠a:",\n            value=default_edit_date,\n            format="DD/MM/YYYY",\n            key="calendar_edit_date"\n        )\n    \n    with col_edit_info:\n        # L·∫•y c√°c ca l√†m vi·ªác c·ªßa ng√†y ƒë√£ ch·ªçn\n        edit_shifts = db.get_shifts_by_date(edit_date)\n        \n        if edit_shifts:\n            total_h = sum(s[\'total_hours\'] for s in edit_shifts)\n            st.success(f"üåü Ng√†y {edit_date.strftime(\'%d/%m/%Y\')}: {len(edit_shifts)} ca, {total_h:.1f} gi·ªù")\n        else:\n            st.info(f"üå∏ Ng√†y {edit_date.strftime(\'%d/%m/%Y\')}: Ch∆∞a c√≥ ca l√†m vi·ªác")\n    \n    # Hi·ªÉn th·ªã v√† cho ph√©p ch·ªânh s·ª≠a c√°c ca\n    if edit_shifts:\n        all_jobs = db.get_all_jobs()\n        job_options = {j[\'id\']: f"{j[\'job_name\']} ({j[\'hourly_rate\']:,.0f} Yen/h)" for j in all_jobs}\n        job_ids = list(job_options.keys())\n        \n        for i, shift in enumerate(edit_shifts):\n            with st.expander(f"üåü {shift[\'shift_name\']} ({shift[\'start_time\']} - {shift[\'end_time\']})", expanded=False):\n                col_e1, col_e2, col_e3 = st.columns(3)\n                \n                with col_e1:\n                    # Ch·ªânh s·ª≠a th·ªùi gian b·∫Øt ƒë·∫ßu\n                    try:\n                        start_parts = shift[\'start_time\'].split(\':\')\n                        default_start = time(int(start_parts[0]), int(start_parts[1]))\n                    except:\n                        default_start = time(9, 0)\n                    \n                    new_start = st.time_input(\n                        "Gi·ªù b·∫Øt ƒë·∫ßu:",\n                        value=default_start,\n                        key=f"edit_start_{shift[\'id\']}"\n                    )\n                \n                with col_e2:\n                    # Ch·ªânh s·ª≠a th·ªùi gian k·∫øt th√∫c\n                    try:\n                        end_parts = shift[\'end_time\'].split(\':\')\n                        default_end = time(int(end_parts[0]), int(end_parts[1]))\n                    except:\n                        default_end = time(17, 0)\n                    \n                    new_end = st.time_input(\n                        "Gi·ªù k·∫øt th√∫c:",\n                        value=default_end,\n                        key=f"edit_end_{shift[\'id\']}"\n                    )\n                \n                with col_e3:\n                    # Ch·ªânh s·ª≠a gi·ªù ngh·ªâ\n                    new_break = st.number_input(\n                        "Gi·ªù ngh·ªâ:",\n                        min_value=0.0,\n                        max_value=4.0,\n                        value=float(shift[\'break_hours\']),\n                        step=0.25,\n                        key=f"edit_break_{shift[\'id\']}"\n                    )\n                \n                col_e4, col_e5 = st.columns(2)\n                \n                with col_e4:\n                    # Ch·ªânh s·ª≠a c√¥ng vi·ªác\n                    current_job_id = shift.get(\'job_id\', 1)\n                    if current_job_id in job_ids:\n                        default_idx = job_ids.index(current_job_id)\n                    else:\n                        default_idx = 0\n                    \n                    new_job = st.selectbox(\n                        "N∆°i l√†m vi·ªác:",\n                        options=job_ids,\n                        index=default_idx,\n                        format_func=lambda x: job_options.get(x, "N/A"),\n                        key=f"edit_job_{shift[\'id\']}"\n                    )\n                \n                with col_e5:\n                    # Ch·ªânh s·ª≠a t√™n ca\n                    new_shift_name = st.text_input(\n                        "T√™n ca:",\n                        value=shift[\'shift_name\'],\n                        key=f"edit_name_{shift[\'id\']}"\n                    )\n                \n                # Ghi ch√∫\n                new_notes = st.text_input(\n                    "Ghi ch√∫:",\n                    value=shift.get(\'notes\', \'\'),\n                    key=f"edit_notes_{shift[\'id\']}"\n                )\n                \n                # T√≠nh gi·ªù l√†m m·ªõi\n                start_dt = datetime.combine(edit_date, new_start)\n                end_dt = datetime.combine(edit_date, new_end)\n                if new_end <= new_start:  # Ca ƒë√™m\n                    end_dt += timedelta(days=1)\n                new_total_hours = (end_dt - start_dt).total_seconds() / 3600 - new_break\n                new_total_hours = max(0, new_total_hours)\n                \n                st.write(f"‚åõ **Gi·ªù l√†m m·ªõi:** {new_total_hours:.1f} gi·ªù")\n                \n                # N√∫t L∆∞u v√† X√≥a\n                col_save, col_del = st.columns(2)\n                \n                with col_save:\n                    if st.button("üíñ L∆∞u Thay ƒê·ªïi", key=f"save_shift_{shift[\'id\']}", type="primary"):\n                        success = db.update_work_shift(\n                            shift_id=shift[\'id\'],\n                            shift_name=new_shift_name,\n                            start_time=new_start.strftime(\'%H:%M\'),\n                            end_time=new_end.strftime(\'%H:%M\'),\n                            break_hours=new_break,\n                            total_hours=new_total_hours,\n                            notes=new_notes\n                        )\n                        if success:\n                            st.success("üéâ ƒê√£ c·∫≠p nh·∫≠t ca l√†m vi·ªác!")\n                            st.rerun()\n                        else:\n                            st.error("üòø L·ªói khi c·∫≠p nh·∫≠t!")\n                \n                with col_del:\n                    if st.button("üóëÔ∏è X√≥a Ca N√†y", key=f"delete_shift_{shift[\'id\']}"):\n                        if db.delete_work_shift(shift[\'id\']):\n                            st.success("üóëÔ∏è ƒê√£ x√≥a ca!")\n                            st.rerun()\n                        else:\n                            st.error("üòø L·ªói khi x√≥a!")\n    \n    # N√∫t th√™m ca m·ªõi cho ng√†y ƒë√£ ch·ªçn\n    st.markdown("---")\n    with st.expander(f"‚ú® Th√™m ca m·ªõi cho ng√†y {edit_date.strftime(\'%d/%m/%Y\')}"):\n        all_jobs = db.get_all_jobs()\n        job_map = {j[\'id\']: j for j in all_jobs}\n        \n        col_add1, col_add2, col_add3 = st.columns(3)\n        \n        with col_add1:\n            add_start = st.time_input("Gi·ªù b·∫Øt ƒë·∫ßu:", value=time(9, 0), key="add_shift_start")\n        with col_add2:\n            add_end = st.time_input("Gi·ªù k·∫øt th√∫c:", value=time(17, 0), key="add_shift_end")\n        with col_add3:\n            add_break = st.number_input("Gi·ªù ngh·ªâ:", min_value=0.0, max_value=4.0, value=1.0, step=0.25, key="add_shift_break")\n        \n        col_add4, col_add5 = st.columns(2)\n        \n        with col_add4:\n            add_job = st.selectbox(\n                "N∆°i l√†m vi·ªác:",\n                options=[j[\'id\'] for j in all_jobs],\n                format_func=lambda x: f"{job_map[x][\'job_name\']} ({job_map[x][\'hourly_rate\']:,.0f} Yen/h)",\n                key="add_shift_job"\n            )\n        with col_add5:\n            add_name = st.text_input("T√™n ca:", value="Ca l√†m", key="add_shift_name")\n        \n        add_notes = st.text_input("Ghi ch√∫:", key="add_shift_notes")\n        \n        # T√≠nh gi·ªù l√†m\n        add_start_dt = datetime.combine(edit_date, add_start)\n        add_end_dt = datetime.combine(edit_date, add_end)\n        if add_end <= add_start:\n            add_end_dt += timedelta(days=1)\n        add_total = max(0, (add_end_dt - add_start_dt).total_seconds() / 3600 - add_break)\n        \n        st.write(f"‚åõ **Gi·ªù l√†m:** {add_total:.1f} gi·ªù | üíù **L∆∞∆°ng ∆∞·ªõc t√≠nh:** {add_total * job_map.get(add_job, {}).get(\'hourly_rate\', 0):,.0f} Yen")\n        \n        if st.button("‚ú® Th√™m Ca", type="primary", key="add_new_shift_calendar"):\n            shift_id = db.add_work_shift(\n                work_date=edit_date,\n                shift_name=add_name,\n                start_time=add_start.strftime(\'%H:%M\'),\n                end_time=add_end.strftime(\'%H:%M\'),\n                break_hours=add_break,\n                total_hours=add_total,\n                notes=add_notes,\n                job_id=add_job\n            )\n            if shift_id > 0:\n                st.success(f"üéâ ƒê√£ th√™m ca l√†m vi·ªác cho ng√†y {edit_date.strftime(\'%d/%m/%Y\')}!")\n                st.rerun()\n            else:\n                st.error("üòø L·ªói khi th√™m ca!")\n\n# ==================== TAB 3: B√ÅO C√ÅO ====================\n\nwith tab3:\n    st.header("‚ú® B√°o C√°o Gi·ªù L√†m")\n    \n    # Ch·ªçn kho·∫£ng th·ªùi gian\n    st.subheader("üìÖ Ch·ªçn Kho·∫£ng Th·ªùi Gian")\n    \n    col1, col2 = st.columns(2)\n    \n    with col1:\n        # M·∫∑c ƒë·ªãnh: ƒë·∫ßu th√°ng hi·ªán t·∫°i\n        default_start = date.today().replace(day=1)\n        report_start = st.date_input(\n            "T·ª´ ng√†y:",\n            value=default_start,\n            format="DD/MM/YYYY"\n        )\n    \n    with col2:\n        report_end = st.date_input(\n            "ƒê·∫øn ng√†y:",\n            value=date.today(),\n            format="DD/MM/YYYY"\n        )\n    \n    if report_start > report_end:\n        st.error("‚ùå Ng√†y b·∫Øt ƒë·∫ßu ph·∫£i tr∆∞·ªõc ng√†y k·∫øt th√∫c!")\n    else:\n        # L·∫•y d·ªØ li·ªáu\n        report_logs = db.get_work_logs_by_range(report_start, report_end)\n        standard_hours = db.get_standard_hours()\n        \n        if report_logs:\n            # T·∫°o b√°o c√°o\n            report = calc.generate_report(report_logs, standard_hours)\n            \n            # Hi·ªÉn th·ªã th·ªëng k√™ (kh√¥ng c√≥ OT)\n            st.subheader("‚ú® Th·ªëng K√™ T·ªïng Quan")\n            \n            col1, col2, col3 = st.columns(3)\n            \n            with col1:\n                st.metric(\n                    "üìÖ S·ªë Ng√†y L√†m",\n                    f"{report[\'total_days\']} ng√†y"\n                )\n            \n            with col2:\n                st.metric(\n                    "‚è±Ô∏è T·ªïng Gi·ªù L√†m",\n                    calc.format_hours(report[\'total_hours\'])\n                )\n            \n            with col3:\n                st.metric(\n                    "üìä Trung B√¨nh/Ng√†y",\n                    calc.format_hours(report[\'average_hours\'])\n                )\n            \n            st.markdown("---")\n            \n            # ==================== T√çNH L∆Ø∆†NG D·ª∞ T√çNH ====================\n            st.subheader("üí∞ L∆∞∆°ng D·ª± T√≠nh")\n            \n            # L·∫•y t·∫•t c·∫£ ca l√†m vi·ªác trong kho·∫£ng th·ªùi gian\n            all_shifts = db.get_shifts_by_range(report_start, report_end)\n            all_jobs = db.get_all_jobs()\n            job_map = {j[\'id\']: j for j in all_jobs}\n            \n            # T√≠nh l∆∞∆°ng theo t·ª´ng c√¥ng vi·ªác\n            job_salary_data = {}\n            total_salary = 0\n            \n            for shift in all_shifts:\n                job_id = shift.get(\'job_id\', 0)\n                hours = shift.get(\'total_hours\', 0)\n                \n                if job_id in job_map:\n                    job_info = job_map[job_id]\n                    job_name = job_info[\'job_name\']\n                    hourly_rate = job_info[\'hourly_rate\']\n                else:\n                    job_name = "Ch∆∞a ph√¢n lo·∫°i"\n                    hourly_rate = 0\n                \n                if job_name not in job_salary_data:\n                    job_salary_data[job_name] = {\n                        \'hours\': 0,\n                        \'salary\': 0,\n                        \'hourly_rate\': hourly_rate,\n                        \'shift_count\': 0\n                    }\n                \n                job_salary_data[job_name][\'hours\'] += hours\n                job_salary_data[job_name][\'salary\'] += hours * hourly_rate\n                job_salary_data[job_name][\'shift_count\'] += 1\n                total_salary += hours * hourly_rate\n            \n            # Hi·ªÉn th·ªã t·ªïng l∆∞∆°ng\n            col_salary1, col_salary2 = st.columns([1, 2])\n            \n            with col_salary1:\n                st.markdown(f"""\n                <div class="stat-card" style="background: linear-gradient(135deg, #F59E0B 0%, #D97706 100%);">\n                    <h3>üí¥ {total_salary:,.0f}</h3>\n                    <p>Yen (L∆∞∆°ng d·ª± t√≠nh)</p>\n                </div>\n                """, unsafe_allow_html=True)\n            \n            with col_salary2:\n                # Hi·ªÉn th·ªã chi ti·∫øt theo t·ª´ng c√¥ng vi·ªác\n                if job_salary_data:\n                    st.markdown("**üìã Chi ti·∫øt theo c√¥ng vi·ªác:**")\n                    for job_name, data in job_salary_data.items():\n                        if data[\'salary\'] > 0:\n                            st.markdown(f"""\n                            - **{job_name}**: {data[\'hours\']:.1f}h √ó {data[\'hourly_rate\']:,.0f} Yen = **{data[\'salary\']:,.0f} Yen** ({data[\'shift_count\']} ca)\n                            """)\n            \n            st.markdown("---")\n            \n            # Bi·ªÉu ƒë·ªì gi·ªù l√†m\n            st.subheader("üìà Bi·ªÉu ƒê·ªì Gi·ªù L√†m")\n            \n            df = pd.DataFrame(report_logs)\n            df[\'work_date\'] = pd.to_datetime(df[\'work_date\'])\n            \n            # Bi·ªÉu ƒë·ªì c·ªôt ƒë∆°n gi·∫£n (ch·ªâ t·ªïng gi·ªù, kh√¥ng ph√¢n chia OT)\n            fig = go.Figure()\n            \n            fig.add_trace(go.Bar(\n                x=df[\'work_date\'],\n                y=df[\'total_hours\'],\n                name=\'Gi·ªù l√†m\',\n                marker_color=\'#22C55E\'\n            ))\n            \n            fig.update_layout(\n                title=\'Gi·ªù L√†m Theo Ng√†y\',\n                xaxis_title=\'Ng√†y\',\n                yaxis_title=\'S·ªë Gi·ªù\',\n                height=400\n            )\n            \n            st.plotly_chart(fig, use_container_width=True)\n            \n            st.markdown("---")\n            \n            # Xu·∫•t Excel\n            st.subheader("üì§ Xu·∫•t B√°o C√°o")\n            \n            # L·∫•y t·∫•t c·∫£ shifts ƒë·ªÉ t√≠nh l∆∞∆°ng\n            export_shifts = db.get_shifts_by_range(report_start, report_end)\n            all_jobs_export = db.get_all_jobs()\n            job_map_export = {j[\'id\']: j for j in all_jobs_export}\n            \n            # Chu·∫©n b·ªã d·ªØ li·ªáu xu·∫•t v·ªõi c·ªôt l∆∞∆°ng\n            export_data = []\n            total_salary_export = 0\n            \n            for shift in export_shifts:\n                job_id = shift.get(\'job_id\', 1)\n                job_info = job_map_export.get(job_id, {\'job_name\': \'N/A\', \'hourly_rate\': 0})\n                salary = shift[\'total_hours\'] * job_info[\'hourly_rate\']\n                total_salary_export += salary\n                \n                export_data.append({\n                    \'Ng√†y\': shift[\'work_date\'],\n                    \'Ca l√†m\': shift[\'shift_name\'],\n                    \'N∆°i l√†m\': job_info[\'job_name\'],\n                    \'Gi·ªù Bƒê\': shift[\'start_time\'],\n                    \'Gi·ªù KT\': shift[\'end_time\'],\n                    \'Ngh·ªâ (h)\': shift[\'break_hours\'],\n                    \'T·ªïng gi·ªù\': shift[\'total_hours\'],\n                    \'L∆∞∆°ng/h\': job_info[\'hourly_rate\'],\n                    \'L∆∞∆°ng ca\': salary,\n                    \'Ghi ch√∫\': shift.get(\'notes\', \'\')\n                })\n            \n            if export_data:\n                df_export = pd.DataFrame(export_data)\n                \n                # Th√™m d√≤ng t·ªïng k·∫øt\n                summary_row = {\n                    \'Ng√†y\': \'T·ªîNG C·ªòNG\',\n                    \'Ca l√†m\': \'\',\n                    \'N∆°i l√†m\': \'\',\n                    \'Gi·ªù Bƒê\': \'\',\n                    \'Gi·ªù KT\': \'\',\n                    \'Ngh·ªâ (h)\': \'\',\n                    \'T·ªïng gi·ªù\': sum(s[\'total_hours\'] for s in export_shifts),\n                    \'L∆∞∆°ng/h\': \'\',\n                    \'L∆∞∆°ng ca\': total_salary_export,\n                    \'Ghi ch√∫\': \'\'\n                }\n                df_export = pd.concat([df_export, pd.DataFrame([summary_row])], ignore_index=True)\n                \n                # T·∫°o file Excel\n                output = BytesIO()\n                with pd.ExcelWriter(output, engine=\'openpyxl\') as writer:\n                    df_export.to_excel(writer, sheet_name=\'Bao Cao Gio Lam\', index=False)\n                \n                excel_data = output.getvalue()\n                \n                col_export1, col_export2 = st.columns(2)\n                \n                with col_export1:\n                    st.download_button(\n                        label="üíæ T·∫£i Excel",\n                        data=excel_data,\n                        file_name=f"bao_cao_{report_start.strftime(\'%d%m%Y\')}_{report_end.strftime(\'%d%m%Y\')}.xlsx",\n                        mime="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",\n                        use_container_width=True\n                    )\n                \n                with col_export2:\n                    # Export CSV\n                    csv_data = df_export.to_csv(index=False).encode(\'utf-8-sig\')\n                    st.download_button(\n                        label="üìÑ T·∫£i CSV",\n                        data=csv_data,\n                        file_name=f"bao_cao_{report_start.strftime(\'%d%m%Y\')}_{report_end.strftime(\'%d%m%Y\')}.csv",\n                        mime="text/csv",\n                        use_container_width=True\n                    )\n                \n                st.success(f"üìä T·ªïng l∆∞∆°ng trong k·ª≥: **{total_salary_export:,.0f} Yen**")\n            \n            # ==================== T√çNH L∆Ø∆†NG ====================\n            st.markdown("---")\n            st.subheader("üíù T√≠nh L∆∞∆°ng Theo Gi·ªù")\n            \n            # L·∫•y t·∫•t c·∫£ shifts trong kho·∫£ng th·ªùi gian b√°o c√°o\n            shifts_data = db.get_shifts_by_range(report_start, report_end)\n            \n            if shifts_data:\n                # L·∫•y danh s√°ch c√¥ng vi·ªác\n                all_jobs = db.get_all_jobs()\n                job_map = {j[\'id\']: j for j in all_jobs}\n                \n                # T√≠nh l∆∞∆°ng theo t·ª´ng c√¥ng vi·ªác\n                job_salary = {}\n                total_hours_all = 0\n                total_salary_all = 0\n                \n                for shift in shifts_data:\n                    job_id = shift.get(\'job_id\') or 1\n                    job_info = job_map.get(job_id, {\'job_name\': \'Chua phan loai\', \'hourly_rate\': 0})\n                    job_name = job_info.get(\'job_name\', \'Chua phan loai\')\n                    hourly_rate = job_info.get(\'hourly_rate\', 0)\n                    hours = shift[\'total_hours\']\n                    \n                    if job_id not in job_salary:\n                        job_salary[job_id] = {\n                            \'job_id\': job_id,\n                            \'job_name\': job_name,\n                            \'hourly_rate\': hourly_rate,\n                            \'total_hours\': 0,\n                            \'shift_count\': 0,\n                            \'base_salary\': 0\n                        }\n                    \n                    job_salary[job_id][\'total_hours\'] += hours\n                    job_salary[job_id][\'shift_count\'] += 1\n                    job_salary[job_id][\'base_salary\'] += hours * hourly_rate\n                    total_hours_all += hours\n                    total_salary_all += hours * hourly_rate\n                \n                # Hi·ªÉn th·ªã t·ªïng quan l∆∞∆°ng\n                col_sal1, col_sal2, col_sal3 = st.columns(3)\n                \n                with col_sal1:\n                    st.metric(\n                        "üíù T·ªïng L∆∞∆°ng",\n                        f"{total_salary_all:,.0f} Yen"\n                    )\n                \n                with col_sal2:\n                    st.metric(\n                        "‚åõ T·ªïng Gi·ªù",\n                        f"{total_hours_all:.1f} gi·ªù"\n                    )\n                \n                with col_sal3:\n                    avg_rate = total_salary_all / total_hours_all if total_hours_all > 0 else 0\n                    st.metric(\n                        "‚ú® TB L∆∞∆°ng/Gi·ªù",\n                        f"{avg_rate:,.0f} Yen/h"\n                    )\n                \n                # Chi ti·∫øt theo c√¥ng vi·ªác\n                if job_salary:\n                    st.markdown("---")\n                    st.markdown("**üìå Chi Ti·∫øt L∆∞∆°ng Theo C√¥ng Vi·ªác:**")\n                    \n                    for job_id, job in job_salary.items():\n                        with st.expander(f"üè† {job[\'job_name\']} - {job[\'total_hours\']:.1f}h = {job[\'base_salary\']:,.0f} Yen"):\n                            col_j1, col_j2, col_j3 = st.columns(3)\n                            with col_j1:\n                                st.write(f"**L∆∞∆°ng gi·ªù:** {job[\'hourly_rate\']:,.0f} Yen/h")\n                            with col_j2:\n                                st.write(f"**S·ªë ca:** {job[\'shift_count\']} ca")\n                            with col_j3:\n                                st.write(f"**T·ªïng gi·ªù:** {job[\'total_hours\']:.1f} gi·ªù")\n                            \n                            st.markdown(f"**T·ªïng l∆∞∆°ng:** `{job[\'base_salary\']:,.0f} Yen` = {job[\'total_hours\']:.1f}h √ó {job[\'hourly_rate\']:,.0f} Yen/h")\n                    \n                    # Bi·ªÉu ƒë·ªì ph√¢n b·ªï l∆∞∆°ng theo c√¥ng vi·ªác\n                    if len(job_salary) > 1:\n                        fig_salary = px.pie(\n                            values=[j[\'base_salary\'] for j in job_salary.values()],\n                            names=[j[\'job_name\'] for j in job_salary.values()],\n                            title=\'Phan Bo Luong Theo Cong Viec\',\n                            color_discrete_sequence=px.colors.qualitative.Pastel\n                        )\n                        st.plotly_chart(fig_salary, use_container_width=True)\n                \n                # B·∫£ng t·ªïng h·ª£p l∆∞∆°ng\n                st.markdown("---")\n                st.markdown(f"""\n                <div class="result-box" style="text-align: center;">\n                    <h3>üíù TONG LUONG ({report_start.strftime(\'%d/%m\')} - {report_end.strftime(\'%d/%m/%Y\')})</h3>\n                    <table style="width: 100%; margin-top: 1rem;">\n                        <tr style="border-bottom: 2px solid #667eea;">\n                            <td style="text-align: left; padding: 0.5rem; font-size: 1.2rem;"><strong>TONG CONG ({total_hours_all:.1f} gio)</strong></td>\n                            <td style="text-align: right; padding: 0.5rem; font-size: 1.5rem; color: #22C55E;"><strong>{total_salary_all:,.0f} Yen</strong></td>\n                        </tr>\n                    </table>\n                </div>\n                """, unsafe_allow_html=True)\n            else:\n                st.info("üå∏ Chua co du lieu de tinh luong. Hay nhap gio lam truoc!")\n                \n        else:\n            st.info("‚ÑπÔ∏è Kh√¥ng c√≥ d·ªØ li·ªáu trong kho·∫£ng th·ªùi gian n√†y.")\n\n# ==================== TAB 4: T√ôY CH·ªàNH ====================\n\nwith tab4:\n    st.header("üéÄ C√†i ƒê·∫∑t C√†i ƒê·∫∑t")\n    \n    # C√†i ƒë·∫∑t gi·ªù l√†m\n    st.subheader("üåü C√†i ƒê·∫∑t Gi·ªù L√†m")\n    \n    col1, col2 = st.columns(2)\n    \n    with col1:\n        current_standard = db.get_standard_hours()\n        new_standard = st.number_input(\n            "Gi·ªù l√†m chu·∫©n (gi·ªù/ng√†y):",\n            min_value=1.0,\n            max_value=12.0,\n            value=current_standard,\n            step=0.5,\n            help="S·ªë gi·ªù l√†m vi·ªác ti√™u chu·∫©n m·ªói ng√†y. Gi·ªù l√†m v∆∞·ª£t qu√° s·∫Ω t√≠nh l√† gi·ªù l√†m th√™m."\n        )\n        \n        if st.button("üíñ L∆∞u Gi·ªù Chu·∫©n", key="save_standard"):\n            if db.update_setting("standard_hours", str(new_standard)):\n                st.success(f"üí´ ƒê√£ c·∫≠p nh·∫≠t gi·ªù l√†m chu·∫©n: {new_standard} gi·ªù")\n            else:\n                st.error("üòø L·ªói khi l∆∞u!")\n    \n    with col2:\n        current_break = db.get_default_break_hours()\n        new_break = st.number_input(\n            "Gi·ªù ngh·ªâ m·∫∑c ƒë·ªãnh (gi·ªù):",\n            min_value=0.0,\n            max_value=3.0,\n            value=current_break,\n            step=0.25,\n            help="Th·ªùi gian ngh·ªâ tr∆∞a v√† ngh·ªâ gi·∫£i lao m·∫∑c ƒë·ªãnh."\n        )\n        \n        if st.button("üíñ L∆∞u Gi·ªù Ngh·ªâ", key="save_break"):\n            if db.update_setting("break_hours", str(new_break)):\n                st.success(f"üí´ ƒê√£ c·∫≠p nh·∫≠t gi·ªù ngh·ªâ m·∫∑c ƒë·ªãnh: {new_break} gi·ªù")\n            else:\n                st.error("üòø L·ªói khi l∆∞u!")\n    \n    st.markdown("---")\n    \n    # ==================== QU·∫¢N L√ù C√îNG VI·ªÜC ====================\n    st.subheader("üè† Qu·∫£n L√Ω C√¥ng Vi·ªác & L∆∞∆°ng Gi·ªù")\n    \n    col_job1, col_job2 = st.columns([1, 2])\n    \n    with col_job1:\n        st.markdown("**üå∫ Th√™m C√¥ng Vi·ªác M·ªõi**")\n        \n        settings_job_name = st.text_input(\n            "T√™n c√¥ng vi·ªác:",\n            placeholder="V√≠ d·ª•: C√¥ng vi·ªác A, Part-time B...",\n            key="settings_new_job_name"\n        )\n        \n        settings_hourly_rate = st.number_input(\n            "L∆∞∆°ng gi·ªù (VNƒê):",\n            min_value=0,\n            max_value=1000000,\n            value=50000,\n            step=5000,\n            key="settings_hourly_rate",\n            help="S·ªë ti·ªÅn l∆∞∆°ng cho m·ªói gi·ªù l√†m vi·ªác"\n        )\n        \n        settings_job_desc = st.text_input(\n            "M√¥ t·∫£ (t√πy ch·ªçn):",\n            placeholder="M√¥ t·∫£ ng·∫Øn v·ªÅ c√¥ng vi·ªác",\n            key="settings_job_desc"\n        )\n        \n        if st.button("üå∫ Th√™m C√¥ng Vi·ªác", type="primary", key="settings_add_job"):\n            if settings_job_name:\n                job_id = db.add_job(settings_job_name, settings_hourly_rate, settings_job_desc)\n                if job_id > 0:\n                    st.success(f"Da them cong viec: {settings_job_name}")\n                    st.rerun()\n                else:\n                    st.error("Loi khi them!")\n            else:\n                st.warning("Vui long nhap ten cong viec!")\n    \n    with col_job2:\n        st.markdown("**üìã Danh S√°ch C√¥ng Vi·ªác**")\n        \n        jobs = db.get_all_jobs()\n        \n        if jobs:\n            for job in jobs:\n                with st.expander(f"üè† {job[\'job_name\']} - {job[\'hourly_rate\']:,.0f} Yen/h"):\n                    col_edit1, col_edit2 = st.columns([2, 1])\n                    \n                    with col_edit1:\n                        # Ch·ªânh s·ª≠a t√™n c√¥ng vi·ªác\n                        updated_name = st.text_input(\n                            "T√™n c√¥ng vi·ªác:",\n                            value=job[\'job_name\'],\n                            key=f"name_{job[\'id\']}"\n                        )\n                        \n                        # Ch·ªânh s·ª≠a l∆∞∆°ng gi·ªù\n                        updated_rate = st.number_input(\n                            f"L∆∞∆°ng gi·ªù (Yen/h):",\n                            min_value=0,\n                            max_value=1000000,\n                            value=int(job[\'hourly_rate\']),\n                            step=100,\n                            key=f"rate_{job[\'id\']}"\n                        )\n                        \n                        # Ch·ªânh s·ª≠a m√¥ t·∫£\n                        updated_desc = st.text_input(\n                            "M√¥ t·∫£:",\n                            value=job.get(\'description\', \'\'),\n                            key=f"desc_{job[\'id\']}"\n                        )\n                        \n                        if st.button("üíñ C·∫≠p Nh·∫≠t C√¥ng Vi·ªác", key=f"update_job_{job[\'id\']}", type="primary"):\n                            if db.update_job(job[\'id\'], updated_name, updated_rate, updated_desc):\n                                st.success("üéâ ƒê√£ c·∫≠p nh·∫≠t c√¥ng vi·ªác!")\n                                st.rerun()\n                            else:\n                                st.error("üòø L·ªói khi c·∫≠p nh·∫≠t!")\n                    \n                    with col_edit2:\n                        st.write(f"**ID:** {job[\'id\']}")\n                        if job.get(\'description\'):\n                            st.write(f"**M√¥ t·∫£:** {job[\'description\']}")\n                        \n                        st.markdown("---")\n                        st.markdown("**üóëÔ∏è X√≥a C√¥ng Vi·ªác**")\n                        \n                        # Ki·ªÉm tra xem c√¥ng vi·ªác c√≥ ƒëang ƒë∆∞·ª£c s·ª≠ d·ª•ng kh√¥ng\n                        # L·∫•y s·ªë ca ƒëang d√πng c√¥ng vi·ªác n√†y\n                        shifts_using = db.get_connection()\n                        cursor = shifts_using.cursor()\n                        cursor.execute("SELECT COUNT(*) FROM work_shifts WHERE job_id = ?", (job[\'id\'],))\n                        count = cursor.fetchone()[0]\n                        shifts_using.close()\n                        \n                        if count > 0:\n                            st.warning(f"‚ö†Ô∏è C√≥ {count} ca ƒëang d√πng c√¥ng vi·ªác n√†y")\n                            \n                            # Checkbox x√°c nh·∫≠n x√≥a\n                            confirm_delete = st.checkbox(\n                                f"T√¥i x√°c nh·∫≠n mu·ªën x√≥a",\n                                key=f"confirm_del_{job[\'id\']}"\n                            )\n                            \n                            if confirm_delete:\n                                if st.button("üóëÔ∏è X√≥a C√¥ng Vi·ªác", key=f"del_job_{job[\'id\']}", type="secondary"):\n                                    if db.delete_job(job[\'id\']):\n                                        st.success("üóëÔ∏è ƒê√£ x√≥a c√¥ng vi·ªác!")\n                                        st.rerun()\n                                    else:\n                                        st.error("üòø L·ªói khi x√≥a!")\n                        else:\n                            st.info("‚úÖ C√¥ng vi·ªác n√†y ch∆∞a ƒë∆∞·ª£c s·ª≠ d·ª•ng")\n                            if st.button("üóëÔ∏è X√≥a C√¥ng Vi·ªác", key=f"del_job_{job[\'id\']}", type="secondary"):\n                                if db.delete_job(job[\'id\']):\n                                    st.success("üóëÔ∏è ƒê√£ x√≥a c√¥ng vi·ªác!")\n                                    st.rerun()\n                                else:\n                                    st.error("üòø L·ªói khi x√≥a!")\n        else:\n            st.info("üå∏ Ch∆∞a c√≥ c√¥ng vi·ªác n√†o. H√£y th√™m c√¥ng vi·ªác m·ªõi!")\n    \n    st.markdown("---")\n    \n    # Qu·∫£n l√Ω ng√†y ngh·ªâ\n    st.subheader("üå∏ Qu·∫£n L√Ω Ng√†y Ngh·ªâ L·ªÖ")\n    \n    col1, col2 = st.columns([1, 2])\n    \n    with col1:\n        st.markdown("**‚ûï Th√™m Ng√†y Ngh·ªâ M·ªõi**")\n        \n        new_holiday_date = st.date_input(\n            "Ch·ªçn ng√†y:",\n            value=date.today(),\n            format="DD/MM/YYYY",\n            key="new_holiday"\n        )\n        \n        new_holiday_desc = st.text_input(\n            "M√¥ t·∫£:",\n            placeholder="V√≠ d·ª•: T·∫øt Nguy√™n ƒê√°n, 30/4, ..."\n        )\n        \n        if st.button("‚ûï Th√™m Ng√†y Ngh·ªâ", type="primary"):\n            if new_holiday_desc.strip():\n                if db.add_holiday(new_holiday_date, new_holiday_desc.strip()):\n                    st.success(f"üéâ ƒê√£ th√™m ng√†y ngh·ªâ: {new_holiday_date.strftime(\'%d/%m/%Y\')} - {new_holiday_desc}")\n                    st.rerun()\n                else:\n                    st.error("üòø L·ªói khi th√™m ng√†y ngh·ªâ!")\n            else:\n                st.warning("‚ö†Ô∏è Vui l√≤ng nh·∫≠p m√¥ t·∫£ cho ng√†y ngh·ªâ!")\n    \n    with col2:\n        st.markdown("**üìã Danh S√°ch Ng√†y Ngh·ªâ**")\n        \n        holidays = db.get_all_holidays()\n        \n        if holidays:\n            for holiday in holidays:\n                hol_date = datetime.strptime(holiday[\'holiday_date\'], \'%Y-%m-%d\').strftime(\'%d/%m/%Y\')\n                col_info, col_delete = st.columns([4, 1])\n                \n                with col_info:\n                    st.write(f"üéå **{hol_date}** - {holiday[\'description\']}")\n                \n                with col_delete:\n                    if st.button("üóëÔ∏è", key=f"del_{holiday[\'id\']}", help="X√≥a ng√†y ngh·ªâ n√†y"):\n                        hol_date_obj = datetime.strptime(holiday[\'holiday_date\'], \'%Y-%m-%d\').date()\n                        if db.remove_holiday(hol_date_obj):\n                            st.success("ƒê√£ x√≥a!")\n                            st.rerun()\n        else:\n            st.info("‚ÑπÔ∏è Ch∆∞a c√≥ ng√†y ngh·ªâ n√†o ƒë∆∞·ª£c th√™m.")\n        \n        st.markdown("---")\n        \n        # Th√™m nhanh ng√†y l·ªÖ Vi·ªát Nam\n        st.markdown("**üáªüá≥ Th√™m Nhanh Ng√†y L·ªÖ Vi·ªát Nam**")\n        \n        current_year = date.today().year\n        vn_holidays = [\n            (date(current_year, 1, 1), "T·∫øt D∆∞∆°ng L·ªãch"),\n            (date(current_year, 4, 30), "Ng√†y Gi·∫£i Ph√≥ng Mi·ªÅn Nam"),\n            (date(current_year, 5, 1), "Ng√†y Qu·ªëc T·∫ø Lao ƒê·ªông"),\n            (date(current_year, 9, 2), "Ng√†y Qu·ªëc Kh√°nh"),\n        ]\n        \n        if st.button("üáªüá≥ Th√™m C√°c Ng√†y L·ªÖ Ch√≠nh NƒÉm " + str(current_year)):\n            added = 0\n            for hol_date, hol_desc in vn_holidays:\n                if db.add_holiday(hol_date, hol_desc):\n                    added += 1\n            st.success(f"üéâ ƒê√£ th√™m {added} ng√†y l·ªÖ!")\n            st.rerun()\n\n# ==================== SIDEBAR ====================\n\nwith st.sidebar:\n    st.markdown("### ‚ú® Th·ªëng K√™ Nhanh")\n    \n    # Th·ªëng k√™ th√°ng hi·ªán t·∫°i\n    today = date.today()\n    current_month_logs = db.get_work_logs_by_month(today.year, today.month)\n    \n    if current_month_logs:\n        total_hours = sum(log[\'total_hours\'] for log in current_month_logs)\n        \n        st.metric("Th√°ng n√†y", f"{len(current_month_logs)} ng√†y")\n        st.metric("T·ªïng gi·ªù l√†m", calc.format_hours(total_hours))\n    else:\n        st.info("Ch∆∞a c√≥ d·ªØ li·ªáu th√°ng n√†y")\n    \n    st.markdown("---")\n    \n    st.markdown("### üíå Th√¥ng Tin")\n    st.markdown("""\n    **Qu·∫£n L√Ω Gi·ªù L√†m** v1.0\n    \n    ·ª®ng d·ª•ng gi√∫p b·∫°n:\n    - üìù Ghi nh·∫≠n gi·ªù l√†m h√†ng ng√†y\n    - üè† Qu·∫£n l√Ω nhi·ªÅu c√¥ng vi·ªác\n    - üí∞ T√≠nh l∆∞∆°ng theo gi·ªù\n    - üìÖ Xem l·ªãch l√†m vi·ªác\n    - üìä T·∫°o b√°o c√°o chi ti·∫øt\n    """)\n    \n    st.markdown("---")\n    \n    # Version info\n    st.caption("¬© 2024 - Ph√°t tri·ªÉn b·ªüi AI")\n\n', 'user_auth.py': '# -*- coding: utf-8 -*-\n"""\nModule x√°c th·ª±c ng∆∞·ªùi d√πng cho ·ª©ng d·ª•ng Qu·∫£n L√Ω Gi·ªù L√†m.\nH·ªó tr·ª£ c·∫£ Supabase (cloud) v√† SQLite (local fallback).\n"""\n\nimport streamlit as st\nimport hashlib\nimport os\nimport sqlite3\nimport sqlite3\ntry:\n    import extra_streamlit_components as stx\n    _COOKIE_MANAGER_OK = True\nexcept ImportError:\n    stx = None\n    _COOKIE_MANAGER_OK = False\nfrom datetime import datetime, timedelta\nfrom typing import Optional, Dict\n\n# Th·ª≠ import Supabase module\ntry:\n    import supabase_db\n    _SUPABASE_MODULE_OK = True\nexcept:\n    _SUPABASE_MODULE_OK = False\n\ndef _check_supabase() -> bool:\n    """Ki·ªÉm tra Supabase c√≥ s·∫µn kh√¥ng (g·ªçi m·ªói l·∫ßn, kh√¥ng cache)."""\n    if not _SUPABASE_MODULE_OK:\n        return False\n    try:\n        return supabase_db.is_supabase_available()\n    except:\n        return False\n\n# ƒê∆∞·ªùng d·∫´n th∆∞ m·ª•c ch·ª©a database c·ªßa users (for SQLite fallback)\nDATA_DIR = os.path.join(os.path.dirname(os.path.abspath(__file__)), "user_data")\n\n# ƒê·∫£m b·∫£o th∆∞ m·ª•c t·ªìn t·∫°i\nif not os.path.exists(DATA_DIR):\n    os.makedirs(DATA_DIR)\n\n\ndef get_users_db_path() -> str:\n    """L·∫•y ƒë∆∞·ªùng d·∫´n database ch·ª©a th√¥ng tin users."""\n    return os.path.join(DATA_DIR, "users.db")\n\n\ndef get_user_db_path(username: str) -> str:\n    """L·∫•y ƒë∆∞·ªùng d·∫´n database ri√™ng c·ªßa user."""\n    safe_username = "".join(c for c in username.lower() if c.isalnum() or c == "_")\n    return os.path.join(DATA_DIR, f"user_{safe_username}.db")\n\n\ndef init_users_db() -> None:\n    """Kh·ªüi t·∫°o database users (SQLite)."""\n    conn = sqlite3.connect(get_users_db_path())\n    cursor = conn.cursor()\n    \n    cursor.execute("""\n        CREATE TABLE IF NOT EXISTS users (\n            id INTEGER PRIMARY KEY AUTOINCREMENT,\n            username TEXT NOT NULL UNIQUE,\n            password_hash TEXT NOT NULL,\n            display_name TEXT,\n            created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n            last_login TIMESTAMP\n        )\n    """)\n    \n    conn.commit()\n    conn.close()\n\n\ndef hash_password(password: str) -> str:\n    """M√£ h√≥a m·∫≠t kh·∫©u."""\n    return hashlib.sha256(password.encode()).hexdigest()\n\n\ndef is_using_supabase() -> bool:\n    """Ki·ªÉm tra c√≥ ƒëang d√πng Supabase kh√¥ng."""\n    return _check_supabase()\n\n\ndef register_user(username: str, password: str, display_name: str = "") -> tuple:\n    """\n    ƒêƒÉng k√Ω ng∆∞·ªùi d√πng m·ªõi.\n    \n    Returns:\n        (success, message)\n    """\n    # Validate input\n    if len(username) < 3:\n        return False, "T√™n ƒëƒÉng nh·∫≠p ph·∫£i c√≥ √≠t nh·∫•t 3 k√Ω t·ª±"\n    \n    if len(password) < 4:\n        return False, "M·∫≠t kh·∫©u ph·∫£i c√≥ √≠t nh·∫•t 4 k√Ω t·ª±"\n    \n    if not username.replace("_", "").isalnum():\n        return False, "T√™n ƒëƒÉng nh·∫≠p ch·ªâ ƒë∆∞·ª£c ch·ª©a ch·ªØ c√°i, s·ªë v√† g·∫°ch d∆∞·ªõi"\n    \n    password_hash = hash_password(password)\n    display = display_name if display_name else username\n    \n    # Th·ª≠ Supabase tr∆∞·ªõc\n    if _check_supabase():\n        try:\n            # Check if user exists\n            existing = supabase_db.get_user_by_username(username)\n            if existing:\n                return False, "T√™n ƒëƒÉng nh·∫≠p ƒë√£ t·ªìn t·∫°i"\n            \n            # Create user\n            user = supabase_db.create_user(username, password_hash, display)\n            if user:\n                # Init default data\n                supabase_db.init_user_default_data(user[\'id\'])\n                return True, "ƒêƒÉng k√Ω th√†nh c√¥ng! B·∫°n c√≥ th·ªÉ ƒëƒÉng nh·∫≠p ngay."\n            else:\n                return False, "L·ªói khi t·∫°o t√†i kho·∫£n"\n        except Exception as e:\n            return False, f"L·ªói: {str(e)}"\n    \n    # Fallback to SQLite\n    try:\n        init_users_db()\n        \n        conn = sqlite3.connect(get_users_db_path())\n        cursor = conn.cursor()\n        \n        cursor.execute("SELECT id FROM users WHERE username = ?", (username.lower(),))\n        if cursor.fetchone():\n            conn.close()\n            return False, "T√™n ƒëƒÉng nh·∫≠p ƒë√£ t·ªìn t·∫°i"\n        \n        cursor.execute("""\n            INSERT INTO users (username, password_hash, display_name)\n            VALUES (?, ?, ?)\n        """, (username.lower(), password_hash, display))\n        \n        conn.commit()\n        conn.close()\n        \n        return True, "ƒêƒÉng k√Ω th√†nh c√¥ng! B·∫°n c√≥ th·ªÉ ƒëƒÉng nh·∫≠p ngay."\n    \n    except Exception as e:\n        return False, f"L·ªói: {str(e)}"\n\n\ndef login_user(username: str, password: str) -> tuple:\n    """\n    ƒêƒÉng nh·∫≠p ng∆∞·ªùi d√πng.\n    \n    Returns:\n        (success, message, user_info)\n    """\n    password_hash = hash_password(password)\n    \n    # Th·ª≠ Supabase tr∆∞·ªõc\n    if _check_supabase():\n        try:\n            user = supabase_db.get_user_by_username(username)\n            if user and user[\'password_hash\'] == password_hash:\n                supabase_db.update_user_last_login(user[\'id\'])\n                return True, "ƒêƒÉng nh·∫≠p th√†nh c√¥ng!", user\n            else:\n                return False, "T√™n ƒëƒÉng nh·∫≠p ho·∫∑c m·∫≠t kh·∫©u kh√¥ng ƒë√∫ng", None\n        except Exception as e:\n            return False, f"L·ªói: {str(e)}", None\n    \n    # Fallback to SQLite\n    try:\n        init_users_db()\n        \n        conn = sqlite3.connect(get_users_db_path())\n        conn.row_factory = sqlite3.Row\n        cursor = conn.cursor()\n        \n        cursor.execute("""\n            SELECT * FROM users WHERE username = ? AND password_hash = ?\n        """, (username.lower(), password_hash))\n        \n        row = cursor.fetchone()\n        \n        if row:\n            cursor.execute("""\n                UPDATE users SET last_login = CURRENT_TIMESTAMP\n                WHERE id = ?\n            """, (row[\'id\'],))\n            conn.commit()\n            \n            user_info = dict(row)\n            conn.close()\n            \n            return True, "ƒêƒÉng nh·∫≠p th√†nh c√¥ng!", user_info\n        else:\n            conn.close()\n            return False, "T√™n ƒëƒÉng nh·∫≠p ho·∫∑c m·∫≠t kh·∫©u kh√¥ng ƒë√∫ng", None\n    \n    except Exception as e:\n        return False, f"L·ªói: {str(e)}", None\n\n\ndef is_logged_in() -> bool:\n    """Ki·ªÉm tra ng∆∞·ªùi d√πng ƒë√£ ƒëƒÉng nh·∫≠p ch∆∞a."""\n    return st.session_state.get("logged_in", False) and st.session_state.get("user_info") is not None\n\n\ndef get_current_user() -> Optional[Dict]:\n    """L·∫•y th√¥ng tin ng∆∞·ªùi d√πng hi·ªán t·∫°i."""\n    if is_logged_in():\n        return st.session_state.get("user_info")\n    return None\n\n\ndef get_current_user_id() -> Optional[int]:\n    """L·∫•y user_id c·ªßa ng∆∞·ªùi d√πng hi·ªán t·∫°i."""\n    user = get_current_user()\n    if user:\n        return user.get(\'id\')\n    return None\n\n\n@st.cache_resource\ndef get_cookie_manager():\n    if not _COOKIE_MANAGER_OK or stx is None:\n        return None\n    try:\n        return stx.CookieManager(key="auth_cookie_manager")\n    except:\n        return None\n\n\ndef set_remember_me_cookie(username: str, password_hash: str):\n    """L∆∞u cookie ƒëƒÉng nh·∫≠p (30 ng√†y)."""\n    if not _COOKIE_MANAGER_OK:\n        return\n        \n    try:\n        cookie_manager = get_cookie_manager()\n        if cookie_manager:\n            # Token format: username|password_hash\n            token = f"{username}|{password_hash}"\n            expires = datetime.now() + timedelta(days=30)\n            cookie_manager.set("work_tracker_token", token, expires_at=expires)\n    except:\n        pass\n\n\ndef check_auto_login() -> bool:\n    """Ki·ªÉm tra cookie ƒë·ªÉ login t·ª± ƒë·ªông."""\n    if is_logged_in():\n        return True\n\n    if not _COOKIE_MANAGER_OK:\n        return False\n\n    try:\n        cookie_manager = get_cookie_manager()\n        if not cookie_manager:\n            return False\n            \n        cookies = cookie_manager.get_all()\n        token = cookies.get("work_tracker_token")\n        \n        if token and "|" in token:\n            username, pw_hash = token.split("|", 1)\n            \n            # Verify with DB\n            if _check_supabase():\n               user = supabase_db.get_user_by_username(username)\n               if user and user[\'password_hash\'] == pw_hash:\n                   st.session_state["logged_in"] = True\n                   st.session_state["user_info"] = user\n                   st.session_state["user_db_path"] = None\n                   supabase_db.update_user_last_login(user[\'id\'])\n                   return True\n            else:\n                # Local SQLite verification\n                init_users_db()\n                conn = sqlite3.connect(get_users_db_path())\n                conn.row_factory = sqlite3.Row\n                cursor = conn.cursor()\n                cursor.execute("SELECT * FROM users WHERE username = ? AND password_hash = ?", (username, pw_hash))\n                row = cursor.fetchone()\n                conn.close()\n                \n                if row:\n                    st.session_state["logged_in"] = True\n                    st.session_state["user_info"] = dict(row)\n                    st.session_state["user_db_path"] = get_user_db_path(username)\n                    \n                    # Update last login\n                    conn = sqlite3.connect(get_users_db_path())\n                    conn.execute("UPDATE users SET last_login = CURRENT_TIMESTAMP WHERE id = ?", (row[\'id\'],))\n                    conn.commit()\n                    conn.close()\n                    return True\n    except Exception as e:\n        print(f"Auto login error: {e}")\n        \n    return False\n\n\ndef logout():\n    """ƒêƒÉng xu·∫•t ng∆∞·ªùi d√πng."""\n    st.session_state["logged_in"] = False\n    st.session_state["user_info"] = None\n    st.session_state["user_db_path"] = None\n    \n    # X√≥a Cookie\n    if _COOKIE_MANAGER_OK:\n        try:\n            cookie_manager = get_cookie_manager()\n            if cookie_manager:\n                cookie_manager.delete("work_tracker_token")\n        except:\n            pass\n\n\ndef show_login_page():\n    """Hi·ªÉn th·ªã trang ƒëƒÉng nh·∫≠p/ƒëƒÉng k√Ω."""\n    \n    st.markdown("""\n    <style>\n        .auth-container {\n            max-width: 400px;\n            margin: 0 auto;\n            padding: 2rem;\n        }\n        .auth-header {\n            text-align: center;\n            margin-bottom: 2rem;\n        }\n        .auth-header h1 {\n            font-size: 3rem;\n            background: linear-gradient(to right, #00C6FB, #005BEA);\n            -webkit-background-clip: text;\n            -webkit-text-fill-color: transparent;\n            font-weight: 800;\n            letter-spacing: 2px;\n            text-transform: uppercase;\n        }\n        .db-status {\n            text-align: center;\n            padding: 0.5rem;\n            border-radius: 8px;\n            margin-bottom: 1rem;\n        }\n    </style>\n    """, unsafe_allow_html=True)\n    \n    st.markdown(\'<div class="auth-header"><h1>üöÄ Qu·∫£n L√Ω Gi·ªù L√†m</h1></div>\', unsafe_allow_html=True)\n    \n    # Hi·ªÉn th·ªã tr·∫°ng th√°i database\n    is_cloud = _check_supabase()\n    if is_cloud:\n        st.success("‚òÅÔ∏è **Cloud Mode** - D·ªØ li·ªáu ƒë∆∞·ª£c l∆∞u tr√™n Supabase")\n    else:\n        st.warning("üíæ **Local Mode** - D·ªØ li·ªáu l∆∞u c·ª•c b·ªô (c√≥ th·ªÉ m·∫•t khi reboot)")\n    \n    # Debug info - LU√îN HI·ªÇN TH·ªä\n    with st.expander("üîß Debug Info - Ki·ªÉm tra k·∫øt n·ªëi", expanded=not is_cloud):\n        import os\n        st.write("**Ki·ªÉm tra Streamlit Secrets:**")\n        has_secrets = hasattr(st, \'secrets\')\n        st.write(f"- hasattr(st, \'secrets\'): `{has_secrets}`")\n        \n        if has_secrets:\n            try:\n                secrets_keys = list(st.secrets.keys()) if hasattr(st.secrets, \'keys\') else "N/A"\n                st.write(f"- Secrets keys: `{secrets_keys}`")\n            except Exception as e:\n                st.write(f"- Secrets keys: Error - `{e}`")\n            \n            try:\n                has_url = "SUPABASE_URL" in st.secrets\n                has_key = "SUPABASE_KEY" in st.secrets\n                st.write(f"- SUPABASE_URL in secrets: `{has_url}`")\n                st.write(f"- SUPABASE_KEY in secrets: `{has_key}`")\n                \n                if has_url:\n                    url_val = st.secrets["SUPABASE_URL"]\n                    st.write(f"- SUPABASE_URL value: `{url_val[:30]}...`")\n            except Exception as e:\n                st.write(f"- Error checking secrets: `{e}`")\n        \n        st.write("**Ki·ªÉm tra Environment Variables:**")\n        env_url = os.environ.get("SUPABASE_URL", "")\n        env_key = os.environ.get("SUPABASE_KEY", "")\n        st.write(f"- ENV SUPABASE_URL: `{\'Set (\' + env_url[:20] + \'...)\' if env_url else \'Not set\'}`")\n        st.write(f"- ENV SUPABASE_KEY: `{\'Set\' if env_key else \'Not set\'}`")\n        \n        st.write("**K·∫øt qu·∫£ ki·ªÉm tra Supabase:**")\n        st.write(f"- _check_supabase(): `{is_cloud}`")\n        st.write(f"- _SUPABASE_MODULE_OK: `{_SUPABASE_MODULE_OK}`")\n        \n        # Show last error if available\n        if not is_cloud:\n            if _SUPABASE_MODULE_OK:\n                try:\n                    last_err = supabase_db.get_last_error()\n                    st.error(f"**L·ªói Supabase:** `{last_err}`")\n                except Exception as ex:\n                    st.error(f"**L·ªói khi l·∫•y error:** `{ex}`")\n            else:\n                st.error("**L·ªói:** Kh√¥ng th·ªÉ import supabase_db module")\n    \n    # Tabs ƒëƒÉng nh·∫≠p / ƒëƒÉng k√Ω\n    tab_login, tab_register = st.tabs(["üë§ ƒêƒÉng Nh·∫≠p", "‚ú® ƒêƒÉng K√Ω"])\n    \n    with tab_login:\n        st.subheader("Ch√†o m·ª´ng tr·ªü l·∫°i üëã")\n        \n        with st.form("login_form"):\n            username = st.text_input("T√™n ƒëƒÉng nh·∫≠p", placeholder="Nh·∫≠p t√™n ƒëƒÉng nh·∫≠p")\n            password = st.text_input("M·∫≠t kh·∫©u", type="password", placeholder="Nh·∫≠p m·∫≠t kh·∫©u")\n            \n            remember_me = False\n            if _COOKIE_MANAGER_OK:\n                remember_me = st.checkbox("Ghi nh·ªõ ƒëƒÉng nh·∫≠p (30 ng√†y)")\n            \n            submit = st.form_submit_button("ƒêƒÉng Nh·∫≠p", use_container_width=True, type="primary")\n            \n            if submit:\n                if username and password:\n                    success, message, user_info = login_user(username, password)\n                    \n                    if success:\n                        st.session_state["logged_in"] = True\n                        st.session_state["user_info"] = user_info\n                        st.session_state["user_db_path"] = get_user_db_path(username)\n                        \n                        if remember_me:\n                            set_remember_me_cookie(username, user_info[\'password_hash\'])\n                            st.toast("ƒê√£ ghi nh·ªõ ƒëƒÉng nh·∫≠p!")\n                        \n                        st.success(message)\n                        st.rerun()\n                    else:\n                        st.error(message)\n                else:\n                    st.warning("Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß th√¥ng tin")\n    \n    with tab_register:\n        st.subheader("T·∫°o t√†i kho·∫£n m·ªõi üéâ")\n        \n        with st.form("register_form"):\n            new_username = st.text_input("T√™n ƒëƒÉng nh·∫≠p", placeholder="√çt nh·∫•t 3 k√Ω t·ª±", key="reg_username")\n            new_display = st.text_input("T√™n hi·ªÉn th·ªã (t√πy ch·ªçn)", placeholder="T√™n b·∫°n mu·ªën hi·ªÉn th·ªã", key="reg_display")\n            new_password = st.text_input("M·∫≠t kh·∫©u", type="password", placeholder="√çt nh·∫•t 4 k√Ω t·ª±", key="reg_password")\n            new_password2 = st.text_input("X√°c nh·∫≠n m·∫≠t kh·∫©u", type="password", placeholder="Nh·∫≠p l·∫°i m·∫≠t kh·∫©u", key="reg_password2")\n            \n            register = st.form_submit_button("ƒêƒÉng K√Ω", use_container_width=True, type="primary")\n            \n            if register:\n                if new_password != new_password2:\n                    st.error("M·∫≠t kh·∫©u kh√¥ng kh·ªõp!")\n                elif new_username and new_password:\n                    success, message = register_user(new_username, new_password, new_display)\n                    if success:\n                        st.success(message)\n                        st.info("H√£y chuy·ªÉn sang tab ƒêƒÉng Nh·∫≠p")\n                    else:\n                        st.error(message)\n                else:\n                    st.warning("Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß th√¥ng tin")\n\n\ndef show_user_info_sidebar():\n    """Hi·ªÉn th·ªã th√¥ng tin user ·ªü sidebar."""\n    user = get_current_user()\n    if user:\n        with st.sidebar:\n            st.markdown("---")\n            st.markdown(f"### üëã Xin ch√†o,\\n**{user.get(\'display_name\') or user.get(\'username\')}**")\n            \n            # Hi·ªÉn th·ªã mode database\n            if is_using_supabase():\n                st.caption("‚òÅÔ∏è Cloud Mode")\n            else:\n                st.caption("üíæ Local Mode")\n                \n            st.markdown("---")\n            \n            if st.button("üö™ ƒêƒÉng xu·∫•t", key="sidebar_logout", use_container_width=True):\n                logout()\n                st.rerun()\n', 'db_wrapper.py': '\ufeff# -*- coding: utf-8 -*-\n"""\nDatabase Wrapper - T√°¬ª¬± √Ñ‚Äò√°¬ª‚Ñ¢ng ch√°¬ª\x8dn Supabase ho√°¬∫¬∑c SQLite.\nImport module n√É\xa0y thay v√É¬¨ import tr√°¬ª¬±c ti√°¬∫¬øp database.py ho√°¬∫¬∑c supabase_db.py\n"""\n\nimport streamlit as st\nfrom datetime import date\nfrom typing import List, Dict, Optional\n\n# Th√°¬ª\xad import Supabase\ntry:\n    import supabase_db\n    _SUPABASE_MODULE_OK = True\nexcept:\n    _SUPABASE_MODULE_OK = False\n\n# Import SQLite fallback\nimport database as sqlite_db\n\n\ndef _check_supabase() -> bool:\n    """Ki√°¬ª∆ím tra Supabase c√É¬≥ s√°¬∫¬µn kh√É¬¥ng (g√°¬ª\x8di m√°¬ª‚Äîi l√°¬∫¬ßn)."""\n    if not _SUPABASE_MODULE_OK:\n        return False\n    try:\n        return supabase_db.is_supabase_available()\n    except:\n        return False\n\n\ndef is_cloud_mode() -> bool:\n    """Ki√°¬ª∆ím tra √Ñ‚Äòang d√É¬πng cloud (Supabase) hay local (SQLite)."""\n    return _check_supabase()\n\n\ndef _get_user_id() -> Optional[int]:\n    """L√°¬∫¬•y user_id t√°¬ª¬´ session."""\n    if "user_info" in st.session_state and st.session_state["user_info"]:\n        return st.session_state["user_info"].get("id")\n    return None\n\n\n# ==================== JOBS ====================\n\ndef get_all_jobs() -> List[Dict]:\n    """L√°¬∫¬•y t√°¬∫¬•t c√°¬∫¬£ c√É¬¥ng vi√°¬ª‚Ä°c."""\n    if _check_supabase():\n        user_id = _get_user_id()\n        if user_id:\n            return supabase_db.get_all_jobs(user_id)\n        return []\n    return sqlite_db.get_all_jobs()\n\n\ndef add_job(job_name: str, hourly_rate: float, description: str = "", color: str = "#667eea") -> Optional[int]:\n    """Th√É¬™m c√É¬¥ng vi√°¬ª‚Ä°c m√°¬ª‚Ä∫i."""\n    if _check_supabase():\n        user_id = _get_user_id()\n        if user_id:\n            return supabase_db.add_job(user_id, job_name, hourly_rate, description, color)\n        return None\n    return sqlite_db.add_job(job_name, hourly_rate, description, color)\n\n\ndef update_job(job_id: int, job_name: str, hourly_rate: float, description: str = "", color: str = "#667eea") -> bool:\n    """C√°¬∫\xadp nh√°¬∫\xadt c√É¬¥ng vi√°¬ª‚Ä°c."""\n    if _check_supabase():\n        return supabase_db.update_job(job_id, job_name, hourly_rate, description, color)\n    return sqlite_db.update_job(job_id, job_name, hourly_rate, description, color)\n\n\ndef delete_job(job_id: int) -> bool:\n    """X√É¬≥a c√É¬¥ng vi√°¬ª‚Ä°c."""\n    if _check_supabase():\n        return supabase_db.delete_job(job_id)\n    return sqlite_db.delete_job(job_id)\n\n\ndef get_job_by_id(job_id: int) -> Optional[Dict]:\n    """L√°¬∫¬•y th√É¬¥ng tin c√É¬¥ng vi√°¬ª‚Ä°c theo ID."""\n    if _check_supabase():\n        jobs = get_all_jobs()\n        for job in jobs:\n            if job[\'id\'] == job_id:\n                return job\n        return None\n    return sqlite_db.get_job_by_id(job_id)\n\n\n# ==================== WORK SHIFTS ====================\n\ndef add_work_shift(\n    work_date: date,\n    shift_name: str,\n    start_time: str,\n    end_time: str,\n    break_hours: float,\n    total_hours: float,\n    notes: str = "",\n    job_id: int = None\n) -> int:\n    """Th√É¬™m ca l√É\xa0m vi√°¬ª‚Ä°c m√°¬ª‚Ä∫i."""\n    if _check_supabase():\n        user_id = _get_user_id()\n        if user_id:\n            result = supabase_db.add_work_shift(user_id, work_date, shift_name, start_time, end_time, break_hours, total_hours, notes, job_id)\n            return result if result else -1\n        return -1\n    return sqlite_db.add_work_shift(work_date, shift_name, start_time, end_time, break_hours, total_hours, notes, job_id)\n\n\ndef update_work_shift(\n    shift_id: int,\n    shift_name: str,\n    start_time: str,\n    end_time: str,\n    break_hours: float,\n    total_hours: float,\n    notes: str = ""\n) -> bool:\n    """C√°¬∫\xadp nh√°¬∫\xadt ca l√É\xa0m vi√°¬ª‚Ä°c."""\n    if _check_supabase():\n        return supabase_db.update_work_shift(shift_id, shift_name, start_time, end_time, break_hours, total_hours, notes)\n    return sqlite_db.update_work_shift(shift_id, shift_name, start_time, end_time, break_hours, total_hours, notes)\n\n\ndef delete_work_shift(shift_id: int) -> bool:\n    """X√É¬≥a ca l√É\xa0m vi√°¬ª‚Ä°c."""\n    if _check_supabase():\n        return supabase_db.delete_work_shift(shift_id)\n    return sqlite_db.delete_work_shift(shift_id)\n\n\ndef get_shifts_by_date(work_date: date) -> List[Dict]:\n    """L√°¬∫¬•y c√É¬°c ca l√É\xa0m vi√°¬ª‚Ä°c theo ng√É\xa0y."""\n    if _check_supabase():\n        user_id = _get_user_id()\n        if user_id:\n            return supabase_db.get_shifts_by_date(user_id, work_date)\n        return []\n    return sqlite_db.get_shifts_by_date(work_date)\n\n\ndef get_shifts_by_range(start_date: date, end_date: date) -> List[Dict]:\n    """L√°¬∫¬•y c√É¬°c ca l√É\xa0m vi√°¬ª‚Ä°c trong kho√°¬∫¬£ng th√°¬ª\x9di gian."""\n    if _check_supabase():\n        user_id = _get_user_id()\n        if user_id:\n            return supabase_db.get_shifts_by_range(user_id, start_date, end_date)\n        return []\n    return sqlite_db.get_shifts_by_range(start_date, end_date)\n\n\ndef get_shift_by_id(shift_id: int) -> Optional[Dict]:\n    """L√°¬∫¬•y th√É¬¥ng tin ca l√É\xa0m vi√°¬ª‚Ä°c theo ID."""\n    return sqlite_db.get_shift_by_id(shift_id)\n\n\ndef get_daily_summary(work_date: date, standard_hours: float = 8.0) -> Dict:\n    """L√°¬∫¬•y t√°¬ª‚Ä¢ng h√°¬ª¬£p gi√°¬ª\x9d l√É\xa0m c√°¬ª¬ßa m√°¬ª‚Ñ¢t ng√É\xa0y."""\n    return sqlite_db.get_daily_summary(work_date, standard_hours)\n\n\ndef get_daily_summaries_by_range(start_date: date, end_date: date, standard_hours: float = 8.0) -> List[Dict]:\n    """L√°¬∫¬•y t√°¬ª‚Ä¢ng h√°¬ª¬£p gi√°¬ª\x9d l√É\xa0m theo ng√É\xa0y trong kho√°¬∫¬£ng th√°¬ª\x9di gian."""\n    return sqlite_db.get_daily_summaries_by_range(start_date, end_date, standard_hours)\n\n\ndef get_daily_summaries_by_month(year: int, month: int, standard_hours: float = 8.0) -> List[Dict]:\n    """L√°¬∫¬•y t√°¬ª‚Ä¢ng h√°¬ª¬£p gi√°¬ª\x9d l√É\xa0m theo ng√É\xa0y trong m√°¬ª‚Ñ¢t th√É¬°ng."""\n    return sqlite_db.get_daily_summaries_by_month(year, month, standard_hours)\n\n\n# ==================== HOLIDAYS ====================\n\ndef add_holiday(holiday_date: date, description: str) -> bool:\n    """Th√É¬™m ng√É\xa0y ngh√°¬ª‚Ä∞."""\n    if _check_supabase():\n        user_id = _get_user_id()\n        if user_id:\n            return supabase_db.add_holiday(user_id, holiday_date, description)\n        return False\n    return sqlite_db.add_holiday(holiday_date, description)\n\n\ndef remove_holiday(holiday_date: date) -> bool:\n    """X√É¬≥a ng√É\xa0y ngh√°¬ª‚Ä∞."""\n    if _check_supabase():\n        user_id = _get_user_id()\n        if user_id:\n            return supabase_db.remove_holiday(user_id, holiday_date)\n        return False\n    return sqlite_db.remove_holiday(holiday_date)\n\n\ndef get_all_holidays() -> List[Dict]:\n    """L√°¬∫¬•y t√°¬∫¬•t c√°¬∫¬£ ng√É\xa0y ngh√°¬ª‚Ä∞."""\n    if _check_supabase():\n        user_id = _get_user_id()\n        if user_id:\n            return supabase_db.get_all_holidays(user_id)\n        return []\n    return sqlite_db.get_all_holidays()\n\n\ndef get_holidays_by_year(year: int) -> List[Dict]:\n    """L·∫•y danh s√°ch ng√†y ngh·ªâ trong nƒÉm."""\n    if _check_supabase():\n        # L·∫•y t·∫•t c·∫£ v√† l·ªçc (t·∫°m th·ªùi)\n        all_holidays = get_all_holidays()\n        return [h for h in all_holidays if str(h.get(\'holiday_date\', \'\')).startswith(str(year))]\n    return sqlite_db.get_holidays_by_year(year)\n\n\ndef is_holiday(check_date: date) -> tuple:\n    """Ki√°¬ª∆ím tra ng√É\xa0y ngh√°¬ª‚Ä∞."""\n    if _check_supabase():\n        user_id = _get_user_id()\n        if user_id:\n            return supabase_db.is_holiday(user_id, check_date)\n        return False, ""\n    return sqlite_db.is_holiday(check_date)\n\n\n# ==================== SETTINGS ====================\n\ndef get_setting(key: str) -> Optional[str]:\n    """L√°¬∫¬•y c√É\xa0i √Ñ‚Äò√°¬∫¬∑t."""\n    if _check_supabase():\n        user_id = _get_user_id()\n        if user_id:\n            return supabase_db.get_setting(user_id, key)\n        return None\n    return sqlite_db.get_setting(key)\n\n\ndef update_setting(key: str, value: str) -> bool:\n    """C√°¬∫\xadp nh√°¬∫\xadt c√É\xa0i √Ñ‚Äò√°¬∫¬∑t."""\n    if _check_supabase():\n        user_id = _get_user_id()\n        if user_id:\n            return supabase_db.update_setting(user_id, key, value)\n        return False\n    return sqlite_db.update_setting(key, value)\n\n\ndef get_standard_hours() -> float:\n    """L√°¬∫¬•y s√°¬ª‚Äò gi√°¬ª\x9d chu√°¬∫¬©n."""\n    if _check_supabase():\n        user_id = _get_user_id()\n        if user_id:\n            return supabase_db.get_standard_hours(user_id)\n        return 8.0\n    return sqlite_db.get_standard_hours()\n\n\ndef get_default_break_hours() -> float:\n    """L√°¬∫¬•y gi√°¬ª\x9d ngh√°¬ª‚Ä∞ m√°¬∫¬∑c √Ñ‚Äò√°¬ª‚Äπnh."""\n    if _check_supabase():\n        user_id = _get_user_id()\n        if user_id:\n            return supabase_db.get_default_break_hours(user_id)\n        return 1.0\n    return sqlite_db.get_default_break_hours()\n\n\ndef get_ot_rate() -> float:\n    """L√°¬∫¬•y h√°¬ª‚Ä° s√°¬ª‚Äò OT."""\n    if _check_supabase():\n        user_id = _get_user_id()\n        if user_id:\n            value = supabase_db.get_setting(user_id, \'ot_rate\')\n            return float(value) if value else 1.25\n        return 1.25\n    return sqlite_db.get_ot_rate()\n\n\n# ==================== DATABASE INIT ====================\n\ndef init_database():\n    """Kh√°¬ª≈∏i t√°¬∫¬°o database."""\n    # Supabase kh√É¬¥ng c√°¬∫¬ßn init (√Ñ‚Äò√É¬£ c√É¬≥ tables s√°¬∫¬µn)\n    if not _check_supabase():\n        sqlite_db.init_database()\n\n\ndef clear_cache():\n    """X√É¬≥a cache."""\n    sqlite_db.clear_cache()\n\n\n# ==================== COMPATIBILITY ====================\n\ndef get_work_logs_by_month(year: int, month: int) -> List[Dict]:\n    """Compatibility wrapper for get_work_logs_by_month."""\n    if _check_supabase():\n        # Map to daily summaries\n        return get_daily_summaries_by_month(year, month)\n    return sqlite_db.get_work_logs_by_month(year, month)\n\n\ndef get_work_logs_by_range(start_date: date, end_date: date) -> List[Dict]:\n    """Compatibility wrapper for get_work_logs_by_range."""\n    if _check_supabase():\n        return get_daily_summaries_by_range(start_date, end_date)\n    return sqlite_db.get_work_logs_by_range(start_date, end_date)\n\n\ndef delete_work_log(work_date: date) -> bool:\n    """Delete all work logs/shifts for a date."""\n    if _check_supabase():\n        # Delete all shifts for this date\n        shifts = get_shifts_by_date(work_date)\n        if not shifts:\n            return True # Nothing to delete\n            \n        success = True\n        for shift in shifts:\n            if not delete_work_shift(shift[\'id\']):\n                success = False\n        return success\n    return sqlite_db.delete_work_log(work_date)\n', 'database.py': '# -*- coding: utf-8 -*-\n"""\nModule qu·∫£n l√Ω c∆° s·ªü d·ªØ li·ªáu SQLite cho ·ª©ng d·ª•ng Qu·∫£n L√Ω Gi·ªù L√†m.\nL∆∞u tr·ªØ gi·ªù l√†m (h·ªó tr·ª£ nhi·ªÅu ca/ng√†y), ng√†y ngh·ªâ, v√† c√†i ƒë·∫∑t ng∆∞·ªùi d√πng.\n"""\n\nimport sqlite3\nfrom datetime import datetime, date\nfrom typing import List, Dict, Optional, Tuple\nimport os\nimport sys\n\n# Thi·∫øt l·∫≠p UTF-8 encoding cho Windows\nos.environ[\'PYTHONIOENCODING\'] = \'utf-8\'\ntry:\n    if sys.stdout and sys.stdout.encoding != \'utf-8\':\n        sys.stdout.reconfigure(encoding=\'utf-8\')\n    if sys.stderr and sys.stderr.encoding != \'utf-8\':\n        sys.stderr.reconfigure(encoding=\'utf-8\')\nexcept:\n    pass\n\n# ƒê∆∞·ªùng d·∫´n database m·∫∑c ƒë·ªãnh (s·∫Ω ƒë∆∞·ª£c ghi ƒë√® b·ªüi user-specific path)\nDEFAULT_DB_PATH = os.path.join(os.path.dirname(os.path.abspath(__file__)), "work_hours.db")\n\ndef get_db_path() -> str:\n    """L·∫•y ƒë∆∞·ªùng d·∫´n database. ∆Øu ti√™n database c·ªßa user n·∫øu ƒë√£ ƒëƒÉng nh·∫≠p."""\n    try:\n        import streamlit as st\n        if "user_db_path" in st.session_state and st.session_state["user_db_path"]:\n            return st.session_state["user_db_path"]\n    except:\n        pass\n    return DEFAULT_DB_PATH\n\n# Alias cho t∆∞∆°ng th√≠ch\nDB_PATH = DEFAULT_DB_PATH\n\n# Cache ƒë∆°n gi·∫£n ƒë·ªÉ t·ªëi ∆∞u ƒë·ªçc database\n_cache = {}\n_cache_timeout = 5  # gi√¢y\n\n\ndef _get_cache(key):\n    """L·∫•y d·ªØ li·ªáu t·ª´ cache n·∫øu c√≤n hi·ªáu l·ª±c."""\n    if key in _cache:\n        data, timestamp = _cache[key]\n        if (datetime.now() - timestamp).seconds < _cache_timeout:\n            return data\n    return None\n\n\ndef _set_cache(key, data):\n    """L∆∞u d·ªØ li·ªáu v√†o cache."""\n    _cache[key] = (data, datetime.now())\n\n\ndef clear_cache():\n    """X√≥a to√†n b·ªô cache."""\n    global _cache\n    _cache = {}\n\n\ndef get_connection() -> sqlite3.Connection:\n    """T·∫°o k·∫øt n·ªëi ƒë·∫øn database."""\n    db_path = get_db_path()\n    # ƒê·∫£m b·∫£o th∆∞ m·ª•c t·ªìn t·∫°i\n    db_dir = os.path.dirname(db_path)\n    if db_dir and not os.path.exists(db_dir):\n        os.makedirs(db_dir)\n    conn = sqlite3.connect(db_path)\n    conn.row_factory = sqlite3.Row  # Cho ph√©p truy c·∫≠p c·ªôt theo t√™n\n    return conn\n\n\ndef init_database() -> None:\n    """Kh·ªüi t·∫°o database v√† t·∫°o c√°c b·∫£ng n·∫øu ch∆∞a t·ªìn t·∫°i."""\n    conn = get_connection()\n    cursor = conn.cursor()\n    \n    # B·∫£ng l∆∞u gi·ªù l√†m h√†ng ng√†y (gi·ªØ l·∫°i ƒë·ªÉ t∆∞∆°ng th√≠ch ng∆∞·ª£c)\n    cursor.execute("""\n        CREATE TABLE IF NOT EXISTS work_logs (\n            id INTEGER PRIMARY KEY AUTOINCREMENT,\n            work_date DATE NOT NULL UNIQUE,\n            start_time TEXT NOT NULL,\n            end_time TEXT NOT NULL,\n            break_hours REAL DEFAULT 1.0,\n            total_hours REAL NOT NULL,\n            overtime_hours REAL DEFAULT 0.0,\n            notes TEXT,\n            created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n            updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP\n        )\n    """)\n    \n    # B·∫£ng l∆∞u c√¥ng vi·ªác v√† l∆∞∆°ng gi·ªù\n    cursor.execute("""\n        CREATE TABLE IF NOT EXISTS jobs (\n            id INTEGER PRIMARY KEY AUTOINCREMENT,\n            job_name TEXT NOT NULL UNIQUE,\n            hourly_rate REAL NOT NULL DEFAULT 0.0,\n            description TEXT,\n            color TEXT DEFAULT \'#667eea\',\n            created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n            updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP\n        )\n    """)\n    \n    # B·∫£ng m·ªõi: L∆∞u c√°c ca l√†m vi·ªác (h·ªó tr·ª£ nhi·ªÅu ca/ng√†y)\n    cursor.execute("""\n        CREATE TABLE IF NOT EXISTS work_shifts (\n            id INTEGER PRIMARY KEY AUTOINCREMENT,\n            work_date DATE NOT NULL,\n            shift_name TEXT DEFAULT \'Ca 1\',\n            job_id INTEGER,\n            start_time TEXT NOT NULL,\n            end_time TEXT NOT NULL,\n            break_hours REAL DEFAULT 0.0,\n            total_hours REAL NOT NULL,\n            notes TEXT,\n            created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n            updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n            FOREIGN KEY (job_id) REFERENCES jobs(id)\n        )\n    """)\n    \n    # Ki·ªÉm tra v√† th√™m c·ªôt job_id n·∫øu ch∆∞a c√≥ (migration)\n    cursor.execute("PRAGMA table_info(work_shifts)")\n    columns = [col[1] for col in cursor.fetchall()]\n    if \'job_id\' not in columns:\n        cursor.execute("ALTER TABLE work_shifts ADD COLUMN job_id INTEGER")\n    \n    # B·∫£ng l∆∞u ng√†y ngh·ªâ l·ªÖ\n    cursor.execute("""\n        CREATE TABLE IF NOT EXISTS holidays (\n            id INTEGER PRIMARY KEY AUTOINCREMENT,\n            holiday_date DATE NOT NULL UNIQUE,\n            description TEXT NOT NULL,\n            created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP\n        )\n    """)\n    \n    # B·∫£ng l∆∞u c√†i ƒë·∫∑t\n    cursor.execute("""\n        CREATE TABLE IF NOT EXISTS settings (\n            key TEXT PRIMARY KEY,\n            value TEXT NOT NULL,\n            updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP\n        )\n    """)\n    \n    # Th√™m c√†i ƒë·∫∑t m·∫∑c ƒë·ªãnh n·∫øu ch∆∞a c√≥\n    default_settings = [\n        ("standard_hours", "8.0"),\n        ("break_hours", "1.0"),\n        ("ot_rate", "1.5"),  # H·ªá s·ªë l∆∞∆°ng OT\n    ]\n    \n    for key, value in default_settings:\n        cursor.execute("""\n            INSERT OR IGNORE INTO settings (key, value) VALUES (?, ?)\n        """, (key, value))\n    \n    # Th√™m c√¥ng vi·ªác m·∫∑c ƒë·ªãnh n·∫øu ch∆∞a c√≥\n    cursor.execute("SELECT COUNT(*) FROM jobs")\n    if cursor.fetchone()[0] == 0:\n        default_jobs = [\n            (\'B·ªánh vi·ªán\', 1200, \'L√†m vi·ªác t·∫°i b·ªánh vi·ªán\', \'#EF4444\'),\n            (\'Kombini\', 1100, \'L√†m vi·ªác t·∫°i c·ª≠a h√†ng ti·ªán l·ª£i\', \'#3B82F6\'),\n            (\'C√¥ng vi·ªác kh√°c\', 1000, \'C√°c c√¥ng vi·ªác kh√°c\', \'#6B7280\')\n        ]\n        \n        for name, rate, desc, color in default_jobs:\n            cursor.execute("""\n                INSERT INTO jobs (job_name, hourly_rate, description, color) \n                VALUES (?, ?, ?, ?)\n            """, (name, rate, desc, color))\n    \n    conn.commit()\n    conn.close()\n\n\n# C·ªù ƒë·ªÉ ki·ªÉm so√°t vi·ªác sync (tr√°nh sync qu√° nhi·ªÅu)\nENABLE_SYNC = True\n\ndef _sync_to_github():\n    """ƒê·ªìng b·ªô database c·ªßa user hi·ªán t·∫°i l√™n GitHub (ch·∫°y background n·∫øu c√≥ th·ªÉ)."""\n    if not ENABLE_SYNC:\n        return\n        \n    try:\n        import streamlit as st\n        import github_sync\n        \n        if "user_info" in st.session_state and st.session_state["user_info"]:\n            username = st.session_state["user_info"]["username"]\n            # Ch·∫°y sync\n            github_sync.sync_push_user_db(username)\n    except Exception as e:\n        print(f"Sync error: {e}")\n\n# ==================== JOBS (C√¥ng vi·ªác v√† l∆∞∆°ng gi·ªù) ====================\n\ndef add_job(job_name: str, hourly_rate: float, description: str = "", color: str = "#667eea") -> int:\n    """Th√™m c√¥ng vi·ªác m·ªõi. N·∫øu ƒë√£ t·ªìn t·∫°i, tr·∫£ v·ªÅ ID c·ªßa job ƒë√≥."""\n    try:\n        conn = get_connection()\n        cursor = conn.cursor()\n        \n        # Ki·ªÉm tra xem job ƒë√£ t·ªìn t·∫°i ch∆∞a\n        cursor.execute("SELECT id FROM jobs WHERE job_name = ?", (job_name,))\n        existing = cursor.fetchone()\n        \n        if existing:\n            # N·∫øu ƒë√£ t·ªìn t·∫°i, c·∫≠p nh·∫≠t l∆∞∆°ng v√† tr·∫£ v·ªÅ ID\n            cursor.execute("""\n                UPDATE jobs SET hourly_rate = ?, description = ?, updated_at = CURRENT_TIMESTAMP\n                WHERE job_name = ?\n            """, (hourly_rate, description, job_name))\n            conn.commit()\n            conn.close()\n            clear_cache()\n            _sync_to_github()  # Sync\n            return existing[0]\n        \n        # Th√™m m·ªõi n·∫øu ch∆∞a t·ªìn t·∫°i\n        cursor.execute("""\n            INSERT INTO jobs (job_name, hourly_rate, description, color)\n            VALUES (?, ?, ?, ?)\n        """, (job_name, hourly_rate, description, color))\n        \n        job_id = cursor.lastrowid\n        conn.commit()\n        conn.close()\n        clear_cache()\n        _sync_to_github()  # Sync\n        return job_id\n    except Exception:\n        return -1\n\n\ndef update_job(job_id: int, job_name: str, hourly_rate: float, description: str = "", color: str = "#667eea") -> bool:\n    """C·∫≠p nh·∫≠t th√¥ng tin c√¥ng vi·ªác."""\n    try:\n        conn = get_connection()\n        cursor = conn.cursor()\n        \n        cursor.execute("""\n            UPDATE jobs SET\n                job_name = ?,\n                hourly_rate = ?,\n                description = ?,\n                color = ?,\n                updated_at = CURRENT_TIMESTAMP\n            WHERE id = ?\n        """, (job_name, hourly_rate, description, color, job_id))\n        \n        conn.commit()\n        conn.close()\n        clear_cache()  # X√≥a cache khi c·∫≠p nh·∫≠t\n        _sync_to_github()  # Sync\n        return True\n    except Exception:\n        return False\n\n\ndef delete_job(job_id: int) -> bool:\n    """X√≥a c√¥ng vi·ªác."""\n    try:\n        conn = get_connection()\n        cursor = conn.cursor()\n        \n        cursor.execute("DELETE FROM jobs WHERE id = ?", (job_id,))\n        \n        conn.commit()\n        conn.close()\n        clear_cache()  # X√≥a cache khi x√≥a\n        _sync_to_github()  # Sync\n        return True\n    except Exception:\n        return False\n\n\ndef get_all_jobs() -> List[Dict]:\n    """L·∫•y t·∫•t c·∫£ c√¥ng vi·ªác (c√≥ cache)."""\n    cached = _get_cache(\'all_jobs\')\n    if cached is not None:\n        return cached\n    \n    conn = get_connection()\n    cursor = conn.cursor()\n    \n    cursor.execute("SELECT * FROM jobs ORDER BY job_name ASC")\n    rows = cursor.fetchall()\n    conn.close()\n    \n    result = [dict(row) for row in rows]\n    _set_cache(\'all_jobs\', result)\n    return result\n\n\ndef get_job_by_id(job_id: int) -> Optional[Dict]:\n    """L·∫•y th√¥ng tin m·ªôt c√¥ng vi·ªác."""\n    conn = get_connection()\n    cursor = conn.cursor()\n    \n    cursor.execute("SELECT * FROM jobs WHERE id = ?", (job_id,))\n    row = cursor.fetchone()\n    conn.close()\n    \n    if row:\n        return dict(row)\n    return None\n\n\ndef get_ot_rate() -> float:\n    """L·∫•y h·ªá s·ªë l∆∞∆°ng OT."""\n    value = get_setting("ot_rate")\n    return float(value) if value else 1.5\n\n\ndef calculate_salary_by_month(year: int, month: int) -> Dict:\n    """\n    T√≠nh l∆∞∆°ng theo th√°ng, ph√¢n chia theo t·ª´ng c√¥ng vi·ªác.\n    \n    Returns:\n        Dict v·ªõi th√¥ng tin l∆∞∆°ng theo t·ª´ng c√¥ng vi·ªác v√† t·ªïng l∆∞∆°ng\n    """\n    from datetime import timedelta\n    \n    start_date = date(year, month, 1)\n    if month == 12:\n        end_date = date(year + 1, 1, 1) - timedelta(days=1)\n    else:\n        end_date = date(year, month + 1, 1) - timedelta(days=1)\n    \n    conn = get_connection()\n    cursor = conn.cursor()\n    \n    # L·∫•y t·∫•t c·∫£ ca l√†m vi·ªác trong th√°ng v·ªõi th√¥ng tin c√¥ng vi·ªác\n    cursor.execute("""\n        SELECT \n            ws.*, \n            j.job_name, \n            j.hourly_rate,\n            j.color\n        FROM work_shifts ws\n        LEFT JOIN jobs j ON ws.job_id = j.id\n        WHERE ws.work_date BETWEEN ? AND ?\n        ORDER BY ws.work_date ASC\n    """, (start_date.isoformat(), end_date.isoformat()))\n    \n    shifts = [dict(row) for row in cursor.fetchall()]\n    conn.close()\n    \n    # L·∫•y c√†i ƒë·∫∑t\n    standard_hours = get_standard_hours()\n    ot_rate = get_ot_rate()\n    \n    # T√≠nh theo t·ª´ng c√¥ng vi·ªác\n    job_salary = {}\n    total_hours_all = 0\n    total_salary_all = 0\n    \n    for shift in shifts:\n        job_id = shift.get(\'job_id\') or 0\n        job_name = shift.get(\'job_name\') or \'Ch∆∞a ph√¢n lo·∫°i\'\n        hourly_rate = shift.get(\'hourly_rate\') or 0\n        color = shift.get(\'color\') or \'#667eea\'\n        hours = shift[\'total_hours\']\n        \n        if job_id not in job_salary:\n            job_salary[job_id] = {\n                \'job_id\': job_id,\n                \'job_name\': job_name,\n                \'hourly_rate\': hourly_rate,\n                \'color\': color,\n                \'total_hours\': 0,\n                \'shift_count\': 0,\n                \'base_salary\': 0\n            }\n        \n        job_salary[job_id][\'total_hours\'] += hours\n        job_salary[job_id][\'shift_count\'] += 1\n        job_salary[job_id][\'base_salary\'] += hours * hourly_rate\n        total_hours_all += hours\n    \n    # T√≠nh OT (t√≠nh theo t·ªïng gi·ªù ng√†y, kh√¥ng theo t·ª´ng ca)\n    # L·∫•y t·ªïng gi·ªù theo ng√†y\n    daily_hours = {}\n    for shift in shifts:\n        day = shift[\'work_date\']\n        if day not in daily_hours:\n            daily_hours[day] = 0\n        daily_hours[day] += shift[\'total_hours\']\n    \n    total_ot_hours = 0\n    for day, hours in daily_hours.items():\n        if hours > standard_hours:\n            total_ot_hours += hours - standard_hours\n    \n    # T√≠nh t·ªïng l∆∞∆°ng\n    for job_id, data in job_salary.items():\n        total_salary_all += data[\'base_salary\']\n    \n    # Th√™m ti·ªÅn OT (t√≠nh d·ª±a tr√™n l∆∞∆°ng trung b√¨nh c√°c c√¥ng vi·ªác)\n    if total_hours_all > 0 and total_salary_all > 0:\n        avg_hourly_rate = total_salary_all / total_hours_all\n        ot_bonus = total_ot_hours * avg_hourly_rate * (ot_rate - 1)  # Ph·∫ßn th∆∞·ªüng OT\n    else:\n        avg_hourly_rate = 0\n        ot_bonus = 0\n    \n    return {\n        \'year\': year,\n        \'month\': month,\n        \'jobs\': list(job_salary.values()),\n        \'total_hours\': round(total_hours_all, 2),\n        \'total_ot_hours\': round(total_ot_hours, 2),\n        \'total_days\': len(daily_hours),\n        \'base_salary\': round(total_salary_all, 0),\n        \'ot_bonus\': round(ot_bonus, 0),\n        \'total_salary\': round(total_salary_all + ot_bonus, 0),\n        \'ot_rate\': ot_rate\n    }\n\n\n# ==================== WORK SHIFTS (Nhi·ªÅu ca/ng√†y) ====================\n\ndef add_work_shift(\n    work_date: date,\n    shift_name: str,\n    start_time: str,\n    end_time: str,\n    break_hours: float,\n    total_hours: float,\n    notes: str = "",\n    job_id: int = None\n) -> int:\n    """\n    Th√™m m·ªôt ca l√†m vi·ªác m·ªõi.\n    \n    Args:\n        work_date: Ng√†y l√†m vi·ªác\n        shift_name: T√™n ca (v√≠ d·ª•: "Ca s√°ng", "Ca t·ªëi")\n        start_time: Gi·ªù b·∫Øt ƒë·∫ßu (HH:MM)\n        end_time: Gi·ªù k·∫øt th√∫c (HH:MM)\n        break_hours: S·ªë gi·ªù ngh·ªâ\n        total_hours: T·ªïng gi·ªù l√†m ca n√†y\n        notes: Ghi ch√∫ (t√πy ch·ªçn)\n        job_id: ID c√¥ng vi·ªác (t√πy ch·ªçn)\n    \n    Returns:\n        ID c·ªßa ca l√†m vi·ªác m·ªõi, -1 n·∫øu l·ªói\n    """\n    try:\n        conn = get_connection()\n        cursor = conn.cursor()\n        \n        cursor.execute("""\n            INSERT INTO work_shifts \n                (work_date, shift_name, job_id, start_time, end_time, break_hours, total_hours, notes)\n            VALUES (?, ?, ?, ?, ?, ?, ?, ?)\n        """, (work_date.isoformat(), shift_name, job_id, start_time, end_time, \n              break_hours, total_hours, notes))\n        \n        shift_id = cursor.lastrowid\n        conn.commit()\n        conn.close()\n        _sync_to_github()  # Sync\n        return shift_id\n    except Exception as e:\n        print(f"L·ªói khi th√™m ca l√†m vi·ªác: {e}")\n        return -1\n\n\ndef update_work_shift(\n    shift_id: int,\n    shift_name: str,\n    start_time: str,\n    end_time: str,\n    break_hours: float,\n    total_hours: float,\n    notes: str = ""\n) -> bool:\n    """C·∫≠p nh·∫≠t m·ªôt ca l√†m vi·ªác."""\n    try:\n        conn = get_connection()\n        cursor = conn.cursor()\n        \n        cursor.execute("""\n            UPDATE work_shifts SET\n                shift_name = ?,\n                start_time = ?,\n                end_time = ?,\n                break_hours = ?,\n                total_hours = ?,\n                notes = ?,\n                updated_at = CURRENT_TIMESTAMP\n            WHERE id = ?\n        """, (shift_name, start_time, end_time, break_hours, total_hours, notes, shift_id))\n        \n        conn.commit()\n        conn.close()\n        _sync_to_github()  # Sync\n        return True\n    except Exception as e:\n        print(f"L·ªói khi c·∫≠p nh·∫≠t ca l√†m vi·ªác: {e}")\n        return False\n\n\ndef delete_work_shift(shift_id: int) -> bool:\n    """X√≥a m·ªôt ca l√†m vi·ªác theo ID."""\n    try:\n        conn = get_connection()\n        cursor = conn.cursor()\n        \n        cursor.execute("DELETE FROM work_shifts WHERE id = ?", (shift_id,))\n        \n        conn.commit()\n        conn.close()\n        _sync_to_github()  # Sync\n        return True\n    except Exception as e:\n        print(f"L·ªói khi x√≥a ca l√†m vi·ªác: {e}")\n        return False\n\n\ndef get_shifts_by_date(work_date: date) -> List[Dict]:\n    """L·∫•y t·∫•t c·∫£ ca l√†m vi·ªác c·ªßa m·ªôt ng√†y."""\n    conn = get_connection()\n    cursor = conn.cursor()\n    \n    cursor.execute("""\n        SELECT * FROM work_shifts \n        WHERE work_date = ?\n        ORDER BY start_time ASC\n    """, (work_date.isoformat(),))\n    \n    rows = cursor.fetchall()\n    conn.close()\n    \n    return [dict(row) for row in rows]\n\n\ndef get_shift_by_id(shift_id: int) -> Optional[Dict]:\n    """L·∫•y th√¥ng tin m·ªôt ca l√†m vi·ªác theo ID."""\n    conn = get_connection()\n    cursor = conn.cursor()\n    \n    cursor.execute("SELECT * FROM work_shifts WHERE id = ?", (shift_id,))\n    \n    row = cursor.fetchone()\n    conn.close()\n    \n    if row:\n        return dict(row)\n    return None\n\n\ndef get_daily_summary(work_date: date, standard_hours: float = 8.0) -> Dict:\n    """\n    L·∫•y t·ªïng h·ª£p gi·ªù l√†m c·ªßa m·ªôt ng√†y (t·∫•t c·∫£ c√°c ca).\n    \n    Returns:\n        Dict v·ªõi total_hours, overtime_hours, shift_count, shifts\n    """\n    shifts = get_shifts_by_date(work_date)\n    \n    if not shifts:\n        return {\n            "work_date": work_date.isoformat(),\n            "total_hours": 0.0,\n            "overtime_hours": 0.0,\n            "shift_count": 0,\n            "shifts": []\n        }\n    \n    total_hours = sum(s[\'total_hours\'] for s in shifts)\n    overtime_hours = max(0, total_hours - standard_hours)\n    \n    return {\n        "work_date": work_date.isoformat(),\n        "total_hours": round(total_hours, 2),\n        "overtime_hours": round(overtime_hours, 2),\n        "shift_count": len(shifts),\n        "shifts": shifts\n    }\n\n\ndef get_shifts_by_range(start_date: date, end_date: date) -> List[Dict]:\n    """L·∫•y t·∫•t c·∫£ ca l√†m vi·ªác trong kho·∫£ng th·ªùi gian."""\n    conn = get_connection()\n    cursor = conn.cursor()\n    \n    cursor.execute("""\n        SELECT * FROM work_shifts \n        WHERE work_date BETWEEN ? AND ?\n        ORDER BY work_date ASC, start_time ASC\n    """, (start_date.isoformat(), end_date.isoformat()))\n    \n    rows = cursor.fetchall()\n    conn.close()\n    \n    return [dict(row) for row in rows]\n\n\ndef get_daily_summaries_by_range(start_date: date, end_date: date, standard_hours: float = 8.0) -> List[Dict]:\n    """\n    L·∫•y t·ªïng h·ª£p gi·ªù l√†m theo ng√†y trong kho·∫£ng th·ªùi gian.\n    G·ªôp c√°c ca trong c√πng m·ªôt ng√†y.\n    """\n    shifts = get_shifts_by_range(start_date, end_date)\n    \n    # G·ªôp theo ng√†y\n    daily_data = {}\n    for shift in shifts:\n        work_date = shift[\'work_date\']\n        if work_date not in daily_data:\n            daily_data[work_date] = {\n                "work_date": work_date,\n                "total_hours": 0.0,\n                "shift_count": 0,\n                "shifts": [],\n                "start_time": shift[\'start_time\'],  # Ca ƒë·∫ßu ti√™n\n                "end_time": shift[\'end_time\'],\n                "break_hours": 0.0,\n                "notes": ""\n            }\n        \n        daily_data[work_date]["total_hours"] += shift[\'total_hours\']\n        daily_data[work_date]["break_hours"] += shift[\'break_hours\']\n        daily_data[work_date]["shift_count"] += 1\n        daily_data[work_date]["shifts"].append(shift)\n        daily_data[work_date]["end_time"] = shift[\'end_time\']  # Ca cu·ªëi c√πng\n        \n        # G·ªôp notes\n        if shift[\'notes\']:\n            if daily_data[work_date]["notes"]:\n                daily_data[work_date]["notes"] += f"; {shift[\'notes\']}"\n            else:\n                daily_data[work_date]["notes"] = shift[\'notes\']\n    \n    # T√≠nh overtime cho m·ªói ng√†y\n    result = []\n    for work_date, data in daily_data.items():\n        data["total_hours"] = round(data["total_hours"], 2)\n        data["overtime_hours"] = round(max(0, data["total_hours"] - standard_hours), 2)\n        result.append(data)\n    \n    # S·∫Øp x·∫øp theo ng√†y\n    result.sort(key=lambda x: x["work_date"])\n    return result\n\n\ndef get_daily_summaries_by_month(year: int, month: int, standard_hours: float = 8.0) -> List[Dict]:\n    """L·∫•y t·ªïng h·ª£p gi·ªù l√†m theo ng√†y trong m·ªôt th√°ng."""\n    start_date = date(year, month, 1)\n    if month == 12:\n        end_date = date(year + 1, 1, 1)\n    else:\n        end_date = date(year, month + 1, 1)\n    \n    from datetime import timedelta\n    end_date = end_date - timedelta(days=1)\n    \n    return get_daily_summaries_by_range(start_date, end_date, standard_hours)\n\n\n# ==================== WORK LOGS (T∆∞∆°ng th√≠ch ng∆∞·ª£c) ====================\n\ndef save_work_log(\n    work_date: date,\n    start_time: str,\n    end_time: str,\n    break_hours: float,\n    total_hours: float,\n    overtime_hours: float,\n    notes: str = ""\n) -> bool:\n    """\n    L∆∞u ho·∫∑c c·∫≠p nh·∫≠t gi·ªù l√†m cho m·ªôt ng√†y (t∆∞∆°ng th√≠ch ng∆∞·ª£c).\n    Ph∆∞∆°ng th·ª©c n√†y s·∫Ω t·∫°o/c·∫≠p nh·∫≠t c·∫£ work_logs v√† work_shifts.\n    """\n    try:\n        conn = get_connection()\n        cursor = conn.cursor()\n        \n        # L∆∞u v√†o work_logs (t∆∞∆°ng th√≠ch ng∆∞·ª£c)\n        cursor.execute("""\n            INSERT INTO work_logs \n                (work_date, start_time, end_time, break_hours, total_hours, overtime_hours, notes)\n            VALUES (?, ?, ?, ?, ?, ?, ?)\n            ON CONFLICT(work_date) DO UPDATE SET\n                start_time = excluded.start_time,\n                end_time = excluded.end_time,\n                break_hours = excluded.break_hours,\n                total_hours = excluded.total_hours,\n                overtime_hours = excluded.overtime_hours,\n                notes = excluded.notes,\n                updated_at = CURRENT_TIMESTAMP\n        """, (work_date.isoformat(), start_time, end_time, break_hours, \n              total_hours, overtime_hours, notes))\n        \n        conn.commit()\n        conn.close()\n        return True\n    except Exception as e:\n        print(f"L·ªói khi l∆∞u gi·ªù l√†m: {e}")\n        return False\n\n\ndef get_work_log(work_date: date) -> Optional[Dict]:\n    """L·∫•y gi·ªù l√†m c·ªßa m·ªôt ng√†y c·ª• th·ªÉ (∆∞u ti√™n t·ª´ work_shifts n·∫øu c√≥)."""\n    # Ki·ªÉm tra work_shifts tr∆∞·ªõc\n    shifts = get_shifts_by_date(work_date)\n    if shifts:\n        standard_hours = get_standard_hours()\n        summary = get_daily_summary(work_date, standard_hours)\n        return {\n            "work_date": work_date.isoformat(),\n            "start_time": shifts[0][\'start_time\'],\n            "end_time": shifts[-1][\'end_time\'],\n            "break_hours": sum(s[\'break_hours\'] for s in shifts),\n            "total_hours": summary[\'total_hours\'],\n            "overtime_hours": summary[\'overtime_hours\'],\n            "notes": "; ".join(s[\'notes\'] for s in shifts if s[\'notes\']),\n            "shift_count": len(shifts),\n            "shifts": shifts\n        }\n    \n    # Fallback: L·∫•y t·ª´ work_logs\n    conn = get_connection()\n    cursor = conn.cursor()\n    \n    cursor.execute("""\n        SELECT * FROM work_logs WHERE work_date = ?\n    """, (work_date.isoformat(),))\n    \n    row = cursor.fetchone()\n    conn.close()\n    \n    if row:\n        result = dict(row)\n        result[\'shift_count\'] = 1\n        result[\'shifts\'] = []\n        return result\n    return None\n\n\ndef get_work_logs_by_range(start_date: date, end_date: date) -> List[Dict]:\n    """L·∫•y danh s√°ch gi·ªù l√†m trong kho·∫£ng th·ªùi gian (k·∫øt h·ª£p c·∫£ 2 b·∫£ng)."""\n    standard_hours = get_standard_hours()\n    \n    # L·∫•y t·ª´ work_shifts (∆∞u ti√™n)\n    daily_summaries = get_daily_summaries_by_range(start_date, end_date, standard_hours)\n    shift_dates = {s[\'work_date\'] for s in daily_summaries}\n    \n    # L·∫•y t·ª´ work_logs cho c√°c ng√†y ch∆∞a c√≥ trong shifts\n    conn = get_connection()\n    cursor = conn.cursor()\n    \n    cursor.execute("""\n        SELECT * FROM work_logs \n        WHERE work_date BETWEEN ? AND ?\n        ORDER BY work_date ASC\n    """, (start_date.isoformat(), end_date.isoformat()))\n    \n    rows = cursor.fetchall()\n    conn.close()\n    \n    # Th√™m c√°c ng√†y t·ª´ work_logs ch∆∞a c√≥ trong shifts\n    for row in rows:\n        if row[\'work_date\'] not in shift_dates:\n            log_dict = dict(row)\n            log_dict[\'shift_count\'] = 1\n            daily_summaries.append(log_dict)\n    \n    # S·∫Øp x·∫øp l·∫°i\n    daily_summaries.sort(key=lambda x: x[\'work_date\'])\n    return daily_summaries\n\n\ndef get_work_logs_by_month(year: int, month: int) -> List[Dict]:\n    """L·∫•y danh s√°ch gi·ªù l√†m trong m·ªôt th√°ng."""\n    start_date = date(year, month, 1)\n    if month == 12:\n        end_date = date(year + 1, 1, 1)\n    else:\n        end_date = date(year, month + 1, 1)\n    \n    from datetime import timedelta\n    end_date = end_date - timedelta(days=1)\n    \n    return get_work_logs_by_range(start_date, end_date)\n\n\ndef delete_work_log(work_date: date) -> bool:\n    """X√≥a gi·ªù l√†m c·ªßa m·ªôt ng√†y (c·∫£ work_logs v√† work_shifts)."""\n    try:\n        conn = get_connection()\n        cursor = conn.cursor()\n        \n        # X√≥a t·ª´ work_logs\n        cursor.execute("DELETE FROM work_logs WHERE work_date = ?", \n                      (work_date.isoformat(),))\n        \n        # X√≥a t·ª´ work_shifts\n        cursor.execute("DELETE FROM work_shifts WHERE work_date = ?", \n                      (work_date.isoformat(),))\n        \n        conn.commit()\n        conn.close()\n        _sync_to_github()  # Sync\n        return True\n    except Exception as e:\n        print(f"L·ªói khi x√≥a gi·ªù l√†m: {e}")\n        return False\n\n\n# ==================== HOLIDAYS ====================\n\ndef add_holiday(holiday_date: date, description: str) -> bool:\n    """Th√™m ng√†y ngh·ªâ l·ªÖ."""\n    try:\n        conn = get_connection()\n        cursor = conn.cursor()\n        \n        cursor.execute("""\n            INSERT OR REPLACE INTO holidays (holiday_date, description)\n            VALUES (?, ?)\n        """, (holiday_date.isoformat(), description))\n        \n        conn.commit()\n        conn.close()\n        _sync_to_github()  # Sync\n        return True\n    except Exception as e:\n        print(f"L·ªói khi th√™m ng√†y ngh·ªâ: {e}")\n        return False\n\n\ndef remove_holiday(holiday_date: date) -> bool:\n    """X√≥a ng√†y ngh·ªâ l·ªÖ."""\n    try:\n        conn = get_connection()\n        cursor = conn.cursor()\n        \n        cursor.execute("DELETE FROM holidays WHERE holiday_date = ?", \n                      (holiday_date.isoformat(),))\n        \n        conn.commit()\n        conn.close()\n        _sync_to_github()  # Sync\n        return True\n    except Exception as e:\n        print(f"L·ªói khi x√≥a ng√†y ngh·ªâ: {e}")\n        return False\n\n\ndef get_all_holidays() -> List[Dict]:\n    """L·∫•y t·∫•t c·∫£ ng√†y ngh·ªâ l·ªÖ."""\n    conn = get_connection()\n    cursor = conn.cursor()\n    \n    cursor.execute("SELECT * FROM holidays ORDER BY holiday_date ASC")\n    rows = cursor.fetchall()\n    conn.close()\n    \n    return [dict(row) for row in rows]\n\n\ndef get_holidays_by_year(year: int) -> List[Dict]:\n    """L·∫•y ng√†y ngh·ªâ l·ªÖ trong m·ªôt nƒÉm."""\n    conn = get_connection()\n    cursor = conn.cursor()\n    \n    cursor.execute("""\n        SELECT * FROM holidays \n        WHERE strftime(\'%Y\', holiday_date) = ?\n        ORDER BY holiday_date ASC\n    """, (str(year),))\n    \n    rows = cursor.fetchall()\n    conn.close()\n    \n    return [dict(row) for row in rows]\n\n\ndef is_holiday(check_date: date) -> Tuple[bool, str]:\n    """Ki·ªÉm tra xem m·ªôt ng√†y c√≥ ph·∫£i ng√†y ngh·ªâ kh√¥ng."""\n    conn = get_connection()\n    cursor = conn.cursor()\n    \n    cursor.execute("""\n        SELECT description FROM holidays WHERE holiday_date = ?\n    """, (check_date.isoformat(),))\n    \n    row = cursor.fetchone()\n    conn.close()\n    \n    if row:\n        return True, row[\'description\']\n    return False, ""\n\n\n# ==================== SETTINGS ====================\n\ndef get_setting(key: str) -> Optional[str]:\n    """L·∫•y gi√° tr·ªã m·ªôt c√†i ƒë·∫∑t."""\n    conn = get_connection()\n    cursor = conn.cursor()\n    \n    cursor.execute("SELECT value FROM settings WHERE key = ?", (key,))\n    row = cursor.fetchone()\n    conn.close()\n    \n    if row:\n        return row[\'value\']\n    return None\n\n\ndef get_all_settings() -> Dict[str, str]:\n    """L·∫•y t·∫•t c·∫£ c√†i ƒë·∫∑t."""\n    conn = get_connection()\n    cursor = conn.cursor()\n    \n    cursor.execute("SELECT key, value FROM settings")\n    rows = cursor.fetchall()\n    conn.close()\n    \n    return {row[\'key\']: row[\'value\'] for row in rows}\n\n\ndef update_setting(key: str, value: str) -> bool:\n    """C·∫≠p nh·∫≠t m·ªôt c√†i ƒë·∫∑t."""\n    try:\n        conn = get_connection()\n        cursor = conn.cursor()\n        \n        cursor.execute("""\n            INSERT INTO settings (key, value) VALUES (?, ?)\n            ON CONFLICT(key) DO UPDATE SET \n                value = excluded.value,\n                updated_at = CURRENT_TIMESTAMP\n        """, (key, value))\n        \n        conn.commit()\n        conn.close()\n        _sync_to_github()  # Sync\n        return True\n    except Exception as e:\n        print(f"L·ªói khi c·∫≠p nh·∫≠t c√†i ƒë·∫∑t: {e}")\n        return False\n\n\ndef get_standard_hours() -> float:\n    """L·∫•y s·ªë gi·ªù l√†m chu·∫©n."""\n    value = get_setting("standard_hours")\n    return float(value) if value else 8.0\n\n\ndef get_default_break_hours() -> float:\n    """L·∫•y s·ªë gi·ªù ngh·ªâ m·∫∑c ƒë·ªãnh."""\n    value = get_setting("break_hours")\n    return float(value) if value else 1.0\n\n\n# Note: Database kh·ªüi t·∫°o ƒë∆∞·ª£c g·ªçi trong app.py sau khi user ƒëƒÉng nh·∫≠p\n# ƒë·ªÉ ƒë·∫£m b·∫£o s·ª≠ d·ª•ng ƒë√∫ng database path c·ªßa user\n', 'calculations.py': '# -*- coding: utf-8 -*-\n"""\nModule t√≠nh to√°n gi·ªù l√†m vi·ªác v√† gi·ªù l√†m th√™m.\nBao g·ªìm c√°c h√†m validate v√† x·ª≠ l√Ω th·ªùi gian.\n"""\n\nfrom datetime import datetime, time, date, timedelta\nfrom typing import Tuple, Optional, Dict, List\nimport pandas as pd\n\n\ndef parse_time(time_str: str) -> Optional[time]:\n    """\n    Chuy·ªÉn ƒë·ªïi chu·ªói th·ªùi gian th√†nh ƒë·ªëi t∆∞·ª£ng time.\n    \n    Args:\n        time_str: Chu·ªói th·ªùi gian ƒë·ªãnh d·∫°ng "HH:MM"\n    \n    Returns:\n        ƒê·ªëi t∆∞·ª£ng time ho·∫∑c None n·∫øu kh√¥ng h·ª£p l·ªá\n    """\n    try:\n        return datetime.strptime(time_str, "%H:%M").time()\n    except ValueError:\n        return None\n\n\ndef time_to_hours(t: time) -> float:\n    """Chuy·ªÉn ƒë·ªïi time th√†nh s·ªë gi·ªù (float)."""\n    return t.hour + t.minute / 60.0\n\n\ndef validate_time_input(start_time: str, end_time: str, allow_overnight: bool = True) -> Tuple[bool, str]:\n    """\n    Ki·ªÉm tra ƒë·∫ßu v√†o th·ªùi gian c√≥ h·ª£p l·ªá kh√¥ng.\n    \n    Args:\n        start_time: Gi·ªù b·∫Øt ƒë·∫ßu (HH:MM)\n        end_time: Gi·ªù k·∫øt th√∫c (HH:MM)\n        allow_overnight: Cho ph√©p ca qua ƒë√™m (gi·ªù k·∫øt th√∫c < gi·ªù b·∫Øt ƒë·∫ßu)\n    \n    Returns:\n        Tuple (is_valid, error_message)\n    """\n    start = parse_time(start_time)\n    end = parse_time(end_time)\n    \n    if start is None:\n        return False, "‚ùå Gi·ªù b·∫Øt ƒë·∫ßu kh√¥ng h·ª£p l·ªá. Vui l√≤ng nh·∫≠p theo ƒë·ªãnh d·∫°ng HH:MM (v√≠ d·ª•: 08:00)"\n    \n    if end is None:\n        return False, "‚ùå Gi·ªù k·∫øt th√∫c kh√¥ng h·ª£p l·ªá. Vui l√≤ng nh·∫≠p theo ƒë·ªãnh d·∫°ng HH:MM (v√≠ d·ª•: 17:00)"\n    \n    # N·∫øu kh√¥ng cho ph√©p ca qua ƒë√™m, ki·ªÉm tra th√¥ng th∆∞·ªùng\n    if not allow_overnight and start >= end:\n        return False, "‚ùå Gi·ªù b·∫Øt ƒë·∫ßu ph·∫£i s·ªõm h∆°n gi·ªù k·∫øt th√∫c!"\n    \n    # N·∫øu cho ph√©p ca qua ƒë√™m v√† start == end, b√°o l·ªói\n    if start == end:\n        return False, "‚ùå Gi·ªù b·∫Øt ƒë·∫ßu v√† gi·ªù k·∫øt th√∫c kh√¥ng th·ªÉ gi·ªëng nhau!"\n    \n    return True, ""\n\n\ndef calculate_work_hours(\n    start_time: str, \n    end_time: str, \n    break_hours: float = 1.0\n) -> Tuple[float, str]:\n    """\n    T√≠nh t·ªïng s·ªë gi·ªù l√†m vi·ªác.\n    H·ªó tr·ª£ ca qua ƒë√™m (v√≠ d·ª•: 17:00 - 00:00 ho·∫∑c 22:00 - 06:00).\n    \n    Args:\n        start_time: Gi·ªù b·∫Øt ƒë·∫ßu (HH:MM)\n        end_time: Gi·ªù k·∫øt th√∫c (HH:MM)\n        break_hours: S·ªë gi·ªù ngh·ªâ (m·∫∑c ƒë·ªãnh 1 gi·ªù)\n    \n    Returns:\n        Tuple (total_hours, error_message)\n        total_hours = -1 n·∫øu c√≥ l·ªói\n    """\n    is_valid, error_msg = validate_time_input(start_time, end_time)\n    if not is_valid:\n        return -1, error_msg\n    \n    start = parse_time(start_time)\n    end = parse_time(end_time)\n    \n    # T√≠nh t·ªïng gi·ªù l√†m\n    start_hours = time_to_hours(start)\n    end_hours = time_to_hours(end)\n    \n    # X·ª≠ l√Ω ca qua ƒë√™m (end_hours < start_hours)\n    if end_hours <= start_hours:\n        # V√≠ d·ª•: 17:00 - 00:00 => 17 - 24 = 7 gi·ªù\n        # V√≠ d·ª•: 22:00 - 06:00 => 22 - 30 = 8 gi·ªù\n        end_hours += 24\n    \n    total_hours = end_hours - start_hours - break_hours\n    \n    if total_hours < 0:\n        return -1, "‚ùå T·ªïng gi·ªù l√†m kh√¥ng th·ªÉ √¢m. Vui l√≤ng ki·ªÉm tra l·∫°i gi·ªù ngh·ªâ!"\n    \n    return round(total_hours, 2), ""\n\n\ndef calculate_overtime(\n    total_hours: float, \n    standard_hours: float = 8.0\n) -> float:\n    """\n    T√≠nh gi·ªù l√†m th√™m.\n    \n    Args:\n        total_hours: T·ªïng gi·ªù l√†m th·ª±c t·∫ø\n        standard_hours: Gi·ªù l√†m chu·∫©n (m·∫∑c ƒë·ªãnh 8 gi·ªù)\n    \n    Returns:\n        S·ªë gi·ªù l√†m th√™m (0 n·∫øu kh√¥ng c√≥ OT)\n    """\n    overtime = total_hours - standard_hours\n    return round(max(0, overtime), 2)\n\n\ndef calculate_full(\n    start_time: str,\n    end_time: str,\n    break_hours: float = 1.0,\n    standard_hours: float = 8.0\n) -> Dict:\n    """\n    T√≠nh to√°n ƒë·∫ßy ƒë·ªß gi·ªù l√†m v√† gi·ªù l√†m th√™m.\n    \n    Returns:\n        Dict v·ªõi c√°c key: success, total_hours, overtime_hours, error_message\n    """\n    result = {\n        "success": False,\n        "total_hours": 0.0,\n        "overtime_hours": 0.0,\n        "error_message": ""\n    }\n    \n    total_hours, error = calculate_work_hours(start_time, end_time, break_hours)\n    \n    if total_hours < 0:\n        result["error_message"] = error\n        return result\n    \n    overtime = calculate_overtime(total_hours, standard_hours)\n    \n    result["success"] = True\n    result["total_hours"] = total_hours\n    result["overtime_hours"] = overtime\n    \n    return result\n\n\ndef format_hours(hours: float) -> str:\n    """\n    Format s·ªë gi·ªù th√†nh chu·ªói d·ªÖ ƒë·ªçc.\n    \n    Args:\n        hours: S·ªë gi·ªù (float)\n    \n    Returns:\n        Chu·ªói ƒë·ªãnh d·∫°ng "X gi·ªù Y ph√∫t"\n    """\n    h = int(hours)\n    m = int((hours - h) * 60)\n    \n    if m == 0:\n        return f"{h} gi·ªù"\n    return f"{h} gi·ªù {m} ph√∫t"\n\n\ndef generate_report(work_logs: List[Dict], standard_hours: float = 8.0) -> Dict:\n    """\n    T·∫°o b√°o c√°o t·ª´ danh s√°ch gi·ªù l√†m.\n    \n    Args:\n        work_logs: Danh s√°ch dict ch·ª©a th√¥ng tin gi·ªù l√†m\n        standard_hours: Gi·ªù l√†m chu·∫©n\n    \n    Returns:\n        Dict ch·ª©a th·ªëng k√™ b√°o c√°o\n    """\n    if not work_logs:\n        return {\n            "total_days": 0,\n            "total_hours": 0.0,\n            "total_overtime": 0.0,\n            "average_hours": 0.0,\n            "days_with_overtime": 0,\n            "max_overtime_day": None,\n            "max_overtime_hours": 0.0\n        }\n    \n    df = pd.DataFrame(work_logs)\n    \n    total_days = len(df)\n    total_hours = df[\'total_hours\'].sum()\n    total_overtime = df[\'overtime_hours\'].sum()\n    average_hours = total_hours / total_days if total_days > 0 else 0\n    days_with_overtime = len(df[df[\'overtime_hours\'] > 0])\n    \n    # Ng√†y c√≥ OT nhi·ªÅu nh·∫•t\n    max_idx = df[\'overtime_hours\'].idxmax()\n    max_overtime_day = df.loc[max_idx, \'work_date\'] if df.loc[max_idx, \'overtime_hours\'] > 0 else None\n    max_overtime_hours = df[\'overtime_hours\'].max()\n    \n    return {\n        "total_days": total_days,\n        "total_hours": round(total_hours, 2),\n        "total_overtime": round(total_overtime, 2),\n        "average_hours": round(average_hours, 2),\n        "days_with_overtime": days_with_overtime,\n        "max_overtime_day": max_overtime_day,\n        "max_overtime_hours": round(max_overtime_hours, 2)\n    }\n\n\ndef get_week_dates(target_date: date) -> Tuple[date, date]:\n    """\n    L·∫•y ng√†y ƒë·∫ßu tu·∫ßn v√† cu·ªëi tu·∫ßn c·ªßa m·ªôt ng√†y.\n    \n    Returns:\n        Tuple (monday, sunday)\n    """\n    monday = target_date - timedelta(days=target_date.weekday())\n    sunday = monday + timedelta(days=6)\n    return monday, sunday\n\n\ndef get_month_dates(year: int, month: int) -> Tuple[date, date]:\n    """\n    L·∫•y ng√†y ƒë·∫ßu th√°ng v√† cu·ªëi th√°ng.\n    \n    Returns:\n        Tuple (first_day, last_day)\n    """\n    first_day = date(year, month, 1)\n    \n    if month == 12:\n        next_month = date(year + 1, 1, 1)\n    else:\n        next_month = date(year, month + 1, 1)\n    \n    last_day = next_month - timedelta(days=1)\n    \n    return first_day, last_day\n', 'requirements.txt': '\ufeffstreamlit>=1.28.0\npandas>=2.0.0\nplotly>=5.18.0\nopenpyxl>=3.1.0\nsupabase>=2.0.0\nextra-streamlit-components>=0.1.0'}

def install():
    print("Installing Work Hours Tracker...")
    for fname, content in files_content.items():
        try:
            with open(fname, "w", encoding="utf-8") as f:
                f.write(content)
            print(f"‚úÖ Created {fname}")
        except Exception as e:
            print(f"‚ùå Error creating {fname}: {e}")
            
    print("\nInstallation complete! üöÄ")
    print("Run the app with: streamlit run app.py")

if __name__ == "__main__":
    install()
